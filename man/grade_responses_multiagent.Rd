% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/grading.R
\name{grade_responses_multiagent}
\alias{grade_responses_multiagent}
\title{Grade Student Responses with Multiagent System}
\usage{
grade_responses_multiagent(
  responses,
  rubric,
  key = NULL,
  template_path = NULL,
  model_config = NULL,
  system_prompt_agent1 = NULL,
  system_prompt_agent2 = NULL,
  max_iterations = 2,
  consistency_threshold = 0.2,
  .temperature = NULL,
  .top_p = NULL,
  .progress = TRUE,
  .parallel = FALSE,
  .cores = NULL
)
}
\arguments{
\item{responses}{Data frame with student responses}

\item{rubric}{Rubric object from load_rubric()}

\item{key}{Answer key object from load_answer_key() (optional)}

\item{template_path}{Path to grading template file}

\item{model_config}{List with model configuration (model name, etc.)}

\item{system_prompt_agent1}{Custom system prompt for first grader (optional)}

\item{system_prompt_agent2}{Custom system prompt for second grader (optional)}

\item{max_iterations}{Maximum re-grading iterations when inconsistent (default: 2)}

\item{consistency_threshold}{Score difference threshold for consistency (default: 0.2)}

\item{.temperature}{Temperature parameter for LLM}

\item{.top_p}{Top_p parameter for LLM}

\item{.progress}{Show progress bar (default: TRUE)}

\item{.parallel}{Use parallel processing (default: FALSE)}

\item{.cores}{Number of cores for parallel processing}
}
\value{
Data frame with grading results including multiagent metadata (agent1_score, agent2_score, score_difference, iterations, was_consistent, grader_agreement_note)
}
\description{
Grade responses using a multiagent system with two independent graders (Agent 1 & 2),
a consistency checker (Agent 3), and a feedback synthesizer (Agent 4).

The system works as follows:
\itemize{
  \item Agent 1 & 2: Two independent graders assess the same response with different perspectives
  \item Agent 3: Checks consistency between the two graders' results
  \item If inconsistent: Provides feedback and triggers re-grading (up to max_iterations)
  \item If consistent: Proceeds to synthesis
  \item Agent 4: Synthesizes final feedback combining insights from both graders
}
}
\details{
The multiagent system provides more reliable grading through:
\itemize{
  \item Multiple perspectives: Two graders with different focus areas
  \item Quality control: Automatic consistency checking
  \item Iterative refinement: Re-grading when results diverge
  \item Rich feedback: Synthesized insights from multiple evaluators
}

Default agent prompts:
\itemize{
  \item Agent 1: Focuses on conceptual understanding and analytical thinking
  \item Agent 2: Focuses on detail and completeness
}

Output includes additional columns:
\itemize{
  \item agent1_score: Score from first grader
  \item agent2_score: Score from second grader
  \item score_difference: Absolute difference between agent scores
  \item iterations: Number of grading iterations performed
  \item was_consistent: Whether graders were consistent
  \item grader_agreement_note: Note on how graders agreed/differed
}
}
\examples{
\dontrun{
responses <- read_csv("data/responses.csv")
rubric <- load_rubric("rubric/item_001.md")
key <- load_answer_key("rubric/item_001_key.md")

# Basic multiagent grading with default settings
results <- grade_responses_multiagent(responses, rubric, key)

# View multiagent-specific metadata
head(results[, c("student_id", "total_score", "agent1_score",
                  "agent2_score", "was_consistent")])

# With custom prompts for different perspectives
results <- grade_responses_multiagent(
  responses, rubric, key,
  system_prompt_agent1 = "ให้คะแนนโดยเน้นแนวคิดและความเข้าใจ",
  system_prompt_agent2 = "ให้คะแนนโดยเน้นรายละเอียดและความสมบูรณ์",
  max_iterations = 3,
  consistency_threshold = 0.15
)

# With parallel processing for multiple responses
results <- grade_responses_multiagent(
  responses, rubric, key,
  .parallel = TRUE,
  .cores = 4
)

# Analyze consistency
summary(results$was_consistent)
mean(results$score_difference)

# View cases where graders disagreed
disagreed <- results[!results$was_consistent, ]
view_student_results(disagreed, student_id = disagreed$student_id[1])
}
}
\seealso{
\code{\link{grade_responses}} for single-agent grading
}
