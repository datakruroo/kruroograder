
![S__75743284_0 copy](https://github.com/user-attachments/assets/e00d7606-b3f4-48fe-9943-fd2fe2050dcb)

# kruroograder ЁЯдЦЁЯУЭ
р╕гр╕░р╕Ър╕Ър╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕нр╕▒р╕Хр╕Щр╕▒р╕вр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╡р╣Ир╣Гр╕Кр╣Й LLM (Large Language Model) р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕│р╕Хр╕нр╕Ър╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕гр╕░р╕Ър╕Ър╣Бр╕ер╕░р╣Вр╕Ыр╕гр╣Ир╕Зр╣Гр╕к

[![R](https://img.shields.io/badge/R-%3E%3D4.0-blue.svg)](https://www.r-project.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## ЁЯОп р╕ар╕▓р╕Юр╕гр╕зр╕бр╣Вр╕Др╕гр╕Зр╕Бр╕▓р╕г

**kruroograder** р╣Ар╕Ыр╣Зр╕Щ R package р╕Чр╕╡р╣Ир╕Юр╕▒р╕Тр╕Щр╕▓р╕Вр╕╢р╣Йр╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕нр╕▒р╕Хр╕Щр╕▒р╕вр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓р╕Щр╕▓р╕Щр╣Бр╕ер╕░р╕нр╕▓р╕Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╕кр╕бр╣Ир╕│р╣Ар╕кр╕бр╕нр╣Гр╕Щр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ р╣Вр╕Фр╕вр╣Гр╕Кр╣Йр╕Юр╕ер╕▒р╕Зр╕Вр╕нр╕З AI р╣Ар╕Юр╕╖р╣Ир╕н:

### ЁЯМЯ р╕Др╕╕р╕Ур╕кр╕бр╕Ър╕▒р╕Хр╕┤р╕лр╕ер╕▒р╕Б
- **ЁЯФН р╣Вр╕Ыр╕гр╣Ир╕Зр╣Гр╕к**: р╕Чр╕╕р╕Бр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕бр╕╡ justification р╕Чр╕╡р╣Ир╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ
- **ЁЯФД Reproducible**: р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Чр╕│р╕Лр╣Йр╕│р╣Др╕Фр╣Йр╣Ар╕лр╕бр╕╖р╕нр╕Щр╣Ар╕Фр╕┤р╕б  
- **тЪб Performance**: р╕гр╕нр╕Зр╕гр╕▒р╕Ъ parallel processing р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Б
- **ЁЯУК Progress Tracking**: р╣Бр╕кр╕Фр╕Зр╕Др╕зр╕▓р╕бр╕Др╕╖р╕Ър╕лр╕Щр╣Йр╕▓р╣Бр╕Ър╕Ъ real-time р╕Юр╕гр╣Йр╕нр╕б percentage
- **ЁЯОУ р╣Ар╕Кр╕┤р╕Зр╕Др╕╕р╕Ур╕ар╕▓р╕Ю**: р╣Гр╕лр╣Й feedback р╕Чр╕╡р╣Ир╕бр╕╡р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣Мр╕Хр╣Ир╕нр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Й
- **ЁЯФз р╕вр╕╖р╕Фр╕лр╕вр╕╕р╣Ир╕Щ**: р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╣Ар╕Бр╕Ур╕Ср╣Мр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╣Др╕Фр╣Йр╕Хр╕▓р╕бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г

### ЁЯПЧя╕П р╕кр╕Цр╕▓р╕Ыр╕▒р╕Хр╕вр╕Бр╕гр╕гр╕бр╕гр╕░р╕Ър╕Ъ
```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   Student       тФВ    тФВ   Rubric &      тФВ    тФВ   LLM Engine    тФВ
тФВ   Responses     тФВтФАтФАтФАтЦ╢тФВ   Answer Key    тФВтФАтФАтФАтЦ╢тФВ   (GPT-5-nano)  тФВ
тФВ   (.csv)        тФВ    тФВ   (.md files)   тФВ    тФВ   + tidyllm     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                                                        тФВ
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР              тФВ
тФВ   Results &     тФВтЧАтФАтФАтФАтФВ   Grading       тФВтЧАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
тФВ   Reports       тФВ    тФВ   Engine        тФВ
тФВ   (CSV/Excel)   тФВ    тФВ   (Parallel)    тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### ЁЯОп р╕Бр╕ер╕╕р╣Ир╕бр╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в
- **р╕нр╕▓р╕Ир╕▓р╕гр╕вр╣М/р╕Др╕гр╕╣**: р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╕Фр╣Ар╕зр╕ер╕▓р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕нр╕▒р╕Хр╕Щр╕▒р╕в
- **р╕Щр╕▒р╕Бр╕зр╕┤р╕Кр╕▓р╕Бр╕▓р╕г**: р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕гр╕░р╕Ър╕Ър╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Чр╕╡р╣Ир╕бр╕╡р╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Фр╣Й
- **р╕кр╕Цр╕▓р╕Ър╕▒р╕Щр╕Бр╕▓р╕гр╕ир╕╢р╕Бр╕йр╕▓**: р╕Чр╕╡р╣Ир╕бр╕╡р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Бр╣Бр╕ер╕░р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╣Гр╕Щр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щ

## ЁЯУж р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З

### р╕Др╕зр╕▓р╕бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ
- **R**: р╣Ар╕зр╕нр╕гр╣Мр╕Кр╕▒р╣Ир╕Щ 4.0 р╕Вр╕╢р╣Йр╕Щр╣Др╕Ы
- **API Key**: OpenAI р╕лр╕гр╕╖р╕н provider р╕нр╕╖р╣Ир╕Щр╣Ж р╕Чр╕╡р╣И tidyllm р╕гр╕нр╕Зр╕гр╕▒р╕Ъ

### р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З

```r
# р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З dependencies р╕Бр╣Ир╕нр╕Щ
install.packages(c("devtools", "tidyllm", "yaml", "tibble", "dplyr", 
                   "readr", "glue", "logger", "parallel", "pbapply"))

# р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╕Ир╕▓р╕Б local development
devtools::install(".")

# р╕лр╕гр╕╖р╕нр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╕Ир╕▓р╕Б GitHub (р╣Ар╕бр╕╖р╣Ир╕нр╕Юр╕гр╣Йр╕нр╕б)
# devtools::install_github("username/kruroograder")
```

### р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ API
```r
# р╕кр╕│р╕лр╕гр╕▒р╕Ъ OpenAI
Sys.setenv(OPENAI_API_KEY = "your-api-key-here")

# р╕лр╕гр╕╖р╕нр╣Гр╕кр╣Ир╣Гр╕Щ .Renviron
# OPENAI_API_KEY=your-api-key-here
```

## ЁЯЪА р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕нр╕вр╣Ир╕▓р╕Зр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╣Вр╕лр╕ер╕Фр╣Бр╕Юр╣Зр╕Бр╣Ар╕Бр╕Ир╣Бр╕ер╕░р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е

```r
library(kruroograder)
library(tidyllm)
library(readr)
library(dplyr)

# р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ logging
init_logger(log_file = "logs/grading.log", log_level = "INFO")
```

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╣Ар╕Хр╕гр╕╡р╕вр╕бр╣Др╕Яр╕ер╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕е

#### 2.1 р╣Др╕Яр╕ер╣Мр╕Др╕│р╕Хр╕нр╕Ър╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ (`data/responses.csv`)
```csv
student_id,item_id,response_text,question_text
001,item_006,"р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕Др╕╖р╕нр╕Бр╕▓р╕гр╕Щр╕│р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕бр╕╡р╕Др╕╕р╕Ур╕ар╕▓р╕Юр╕бр╕▓р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М...","р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Вр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И"
002,item_006,"р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Ыр╣Зр╕Щр╕кр╕┤р╣Ир╕Зр╕кр╕│р╕Др╕▒р╕Нр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╣Ар╕Юр╕гр╕▓р╕░р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕гр╕▓р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕кр╕Цр╕▓р╕Щр╕Бр╕▓р╕гр╕Ур╣М...","р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Вр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И"
```

#### 2.2 р╣Др╕Яр╕ер╣М Rubric (`rubric/item_006_rubric.md`)
```yaml
---
item_id: "item_006"
max_score: 9
question: |
  р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Вр╕нр╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И р╕Юр╕гр╣Йр╕нр╕бр╕вр╕Бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Ыр╕гр╕░р╕Бр╕нр╕Ъ
criteria:
  - id: C1
    name: "р╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕Щр╕зр╕Др╕┤р╕Ф"
    points: 3
    descriptors:
      full: "р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Фр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Бр╕ер╕░р╣Бр╕бр╣Ир╕Щр╕вр╕│ (3 р╕Др╕░р╣Бр╕Щр╕Щ)"
      partial: "р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Др╕Фр╣Йр╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щр╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ (1-2 р╕Др╕░р╣Бр╕Щр╕Щ)"
      none: "р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Др╕Фр╣Йр╕лр╕гр╕╖р╕нр╕нр╕Шр╕┤р╕Ър╕▓р╕вр╕Ьр╕┤р╕Ф (0 р╕Др╕░р╣Бр╕Щр╕Щ)"
  - id: C2
    name: "р╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З"
    points: 3
    descriptors:
      full: "р╕вр╕Бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╣Бр╕ер╕░р╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕Зр╕Бр╕▒р╕Ър╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓ (3 р╕Др╕░р╣Бр╕Щр╕Щ)"
      partial: "р╕вр╕Бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕Фр╣Йр╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щр╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ (1-2 р╕Др╕░р╣Бр╕Щр╕Щ)"
      none: "р╣Др╕бр╣Ир╕бр╕╡р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕лр╕гр╕╖р╕нр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕бр╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б (0 р╕Др╕░р╣Бр╕Щр╕Щ)"
  - id: C3
    name: "р╕Др╕зр╕▓р╕бр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Др╕│р╕Хр╕нр╕Ъ"
    points: 3
    descriptors:
      full: "р╕Др╕│р╕Хр╕нр╕Ър╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ р╕бр╕╡р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╣Бр╕ер╕░р╕кр╕гр╕╕р╕Ы (3 р╕Др╕░р╣Бр╕Щр╕Щ)"
      partial: "р╕Др╕│р╕Хр╕нр╕Ър╕Др╣Ир╕нр╕Щр╕Вр╣Йр╕▓р╕Зр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╣Бр╕Хр╣Ир╕Вр╕▓р╕Фр╕Ър╕▓р╕Зр╕кр╣Ир╕зр╕Щ (1-2 р╕Др╕░р╣Бр╕Щр╕Щ)"
      none: "р╕Др╕│р╕Хр╕нр╕Ър╣Др╕бр╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕лр╕гр╕╖р╕нр╕Вр╕▓р╕Фр╕лр╕ер╕▓р╕вр╕кр╣Ир╕зр╕Щ (0 р╕Др╕░р╣Бр╕Щр╕Щ)"
---
```

#### 2.3 р╣Др╕Яр╕ер╣М Answer Key (`rubric/item_006_key.md`)
```yaml
---
item_id: "item_006"
core_points:
  - "р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Кр╣Ир╕зр╕вр╕ер╕Фр╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╣Бр╕Щр╣Ир╕Щр╕нр╕Щр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И"
  - "р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Чр╕▒р╕Щр╕кр╕бр╕▒р╕вр╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю"
  - "р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╣Ар╕лр╣Зр╕Щр╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕бр╣Бр╕ер╕░р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ"
exemplar: |
  р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕нр╕вр╣Ир╕▓р╕Зр╕вр╕┤р╣Ир╕Зр╣Гр╕Щр╕вр╕╕р╕Др╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ р╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╕Ир╕▓р╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Кр╣Ир╕зр╕вр╕ер╕Фр╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╣Бр╕Щр╣Ир╕Щр╕нр╕Щ
  р╣Бр╕ер╕░р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Кр╣Ир╕Щ р╣Гр╕Щр╕Шр╕╕р╕гр╕Бр╕┤р╕И р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕вр╕нр╕Фр╕Вр╕▓р╕вр╣Гр╕Щр╕нр╕Фр╕╡р╕Х
  р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕▓р╕бр╕▓р╕гр╕Цр╕зр╕▓р╕Зр╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╕Ьр╕ер╕┤р╕Хр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Хр╕ер╕▓р╕Фр╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
common_misconceptions:
  - "р╕Др╕┤р╕Фр╕зр╣Ир╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕бр╕▓р╕Бр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щр╕Бр╣Зр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Др╕│р╕Щр╕╢р╕Зр╕Цр╕╢р╕Зр╕Др╕╕р╕Ур╕ар╕▓р╕Ю"
  - "р╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓р╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕Зр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И"
---
```

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 3: р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И

```r
# р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е
responses <- read_csv("data/responses.csv")
rubric <- load_rubric("rubric/item_006_rubric.md")
answer_key <- load_answer_key("rubric/item_006_key.md")

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
validate_response_data(responses)
cat("р╕Ир╕│р╕Щр╕зр╕Щр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ:", nrow(responses), "р╕Др╕Щ\n")
cat("р╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕Хр╣Зр╕б:", rubric$max_score, "р╕Др╕░р╣Бр╕Щр╕Щ\n")
```

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 4: р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Бр╕ер╕░р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ

#### 4.1 р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ъ Sequential (р╕Чр╕╡р╕ер╕░р╕Др╕Щ)
```r
# р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ър╕Ыр╕Бр╕Хр╕┤
results_seq <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  .progress = TRUE,           # р╣Бр╕кр╕Фр╕З progress bar
  .parallel = FALSE           # р╣Др╕бр╣Ир╣Гр╕Кр╣Й parallel processing
)
```

#### 4.2 р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ъ Parallel (р╕лр╕ер╕▓р╕вр╕Др╕Щр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ)
```r
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕зр╕гр╣Гр╕Кр╣Й parallel р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
n_students <- nrow(responses)
if (should_use_parallel(n_students)) {
  recommended_cores <- get_optimal_cores(n_students)
  cat("р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╣Йр╣Гр╕Кр╣Й", recommended_cores, "cores р╕кр╕│р╕лр╕гр╕▒р╕Ъ", n_students, "р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ\n")
  
  # р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ъ parallel
  results_par <- grade_responses(
    responses = responses,
    rubric = rubric, 
    key = answer_key,
    .progress = TRUE,         # р╣Бр╕кр╕Фр╕З progress bar
    .parallel = TRUE,         # р╣Гр╕Кр╣Й parallel processing
    .cores = recommended_cores # р╕Ир╕│р╕Щр╕зр╕Щ cores
  )
} else {
  cat("р╕Ир╕│р╕Щр╕зр╕Щр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Щр╣Йр╕нр╕в р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╣Йр╣Гр╕Кр╣Й sequential processing\n")
  results_par <- results_seq
}
```

#### 4.3 р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╣Вр╕бр╣Ар╕Фр╕е
```r
# р╕Бр╕│р╕лр╕Щр╕Фр╕Др╣Ир╕▓р╣Вр╕бр╣Ар╕Фр╕ер╣Ар╕нр╕З
custom_model_config <- list(
  model = "gpt-4o-mini",      # р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Вр╕бр╣Ар╕Фр╕е
  provider = "openai"         # р╕Ьр╕╣р╣Йр╣Гр╕лр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕г
)

results_custom <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  model_config = custom_model_config,
  .parallel = TRUE,
  .cores = 4
)
```

#### 4.4 р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З System Prompt
```r
# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З 1: р╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Ф
strict_prompt <- "р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╣Бр╕ер╕░р╣Гр╕Кр╣Йр╣Ар╕Бр╕Ур╕Ср╣Мр╕кр╕╣р╕З р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Вр╣Йр╕бр╕Вр╣Йр╕Щ р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕Хр╣Зр╕бр╕Зр╣Ир╕▓р╕вр╣Ж р╣Бр╕ер╕░р╕Кр╕╡р╣Йр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╕нр╕вр╣Ир╕▓р╕Зр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ"

results_strict <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  system_prompt = strict_prompt
)

# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З 2: р╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╣Гр╕лр╣Йр╕Бр╕│р╕ер╕▒р╕Зр╣Гр╕И
encouraging_prompt <- "р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕Бр╕│р╕ер╕▒р╕Зр╣Гр╕Ир╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕гр╕Зр╕Ър╕▒р╕Щр╕Фр╕▓р╕ер╣Гр╕И р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕бр╣Бр╕Хр╣Ир╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╣Ар╕Кр╕┤р╕Зр╕Ър╕зр╕Бр╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣М"

results_encouraging <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  system_prompt = encouraging_prompt
)

# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З 3: р╕ар╕▓р╕йр╕▓р╕нр╕▒р╕Зр╕Бр╕др╕й
english_prompt <- "You are an expert educator specializing in data-driven classroom assessment. Grade student responses fairly and consistently according to the provided rubric."

results_english <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  system_prompt = english_prompt
)
```

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 5: р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

```r
# р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Вр╕Фр╕вр╕кр╕гр╕╕р╕Ы
head(results_par)
summary(results_par$total_score)

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Др╕░р╣Бр╕Щр╕Щ
table(results_par$total_score)

# р╕Фр╕╣ feedback р╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Др╕Щр╣Бр╕гр╕Б
cat("р╕Др╕░р╣Бр╕Щр╕Щ:", results_par$total_score[1], "/", rubric$max_score, "\n")
cat("Feedback:", results_par$overall_feedback[1], "\n")
```

### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 6: р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

```r
# р╕кр╣Ир╕Зр╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щ CSV
export_results(results_par, "output/grades.csv", format = "csv")

# р╕кр╣Ир╕Зр╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щ Excel р╕Юр╕гр╣Йр╕нр╕б feedback
export_results(results_par, "output/grades_with_feedback.xlsx", 
               format = "xlsx", include_feedback = TRUE)

# р╕кр╣Ир╕Зр╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щ JSON
export_results(results_par, "output/grades.json", format = "json")

# р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ы
create_grading_report(results_par, "output/grading_report.md")
```

## ЁЯУК р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

### Progress Display
```
Starting parallel grading with 4 cores...
Progress: 25/100 (25.0%) completed
Progress: 50/100 (50.0%) completed  
Progress: 75/100 (75.0%) completed
Progress: 100/100 (100.0%) completed
```

### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
```r
# р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Гр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ data frame
> head(results_par)
  student_id item_id total_score            overall_feedback
1        001 item_006        7.5  р╕Ир╕╕р╕Фр╣Бр╕Вр╣Зр╕З: р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕Щр╕зр╕Др╕┤р╕Фр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ...
2        002 item_006        6.0  р╕Др╕зр╕гр╣Гр╕лр╣Йр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б...
3        003 item_006        8.5  р╕Др╕│р╕Хр╕нр╕Ър╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Бр╕ер╕░р╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ...
```

### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ы
```
# Grading Report

## Summary Statistics
- Total Responses: 100
- Mean Score: 7.25
- Median Score: 7.50
- Min Score: 3.00
- Max Score: 9.00

## Score Distribution
3.0: 2 students
4.5: 5 students  
6.0: 15 students
7.5: 45 students
9.0: 33 students

Generated on: 2024-01-15 14:30:25
```

## ЁЯФз р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕ер╕▒р╕Бр╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### ЁЯУЭ р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕ер╕▒р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ъ

| р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й |
|---------|----------|----------------|
| `load_rubric()` | р╣Вр╕лр╕ер╕Фр╣Ар╕Бр╕Ур╕Ср╣Мр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ | `rubric <- load_rubric("rubric/item_001.md")` |
| `load_answer_key()` | р╣Вр╕лр╕ер╕Фр╣Ар╕Йр╕ер╕вр╣Бр╕ер╕░р╣Бр╕Щр╕зр╕Др╕│р╕Хр╕нр╕Ъ | `key <- load_answer_key("rubric/item_001_key.md")` |
| `grade_responses()` | р╕Хр╕гр╕зр╕Ир╣Бр╕ер╕░р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ (single-agent) | `results <- grade_responses(responses, rubric, key, .parallel = TRUE)` |
| `grade_responses_multiagent()` | р╕Хр╕гр╕зр╕Ир╣Бр╕ер╕░р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ (multiagent) ЁЯЖХ | `results <- grade_responses_multiagent(responses, rubric, key, max_iterations = 3)` |
| `export_results()` | р╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М | `export_results(results, "output.csv")` |
| `create_grading_report()` | р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ы | `create_grading_report(results, "report.md")` |
| `create_grading_schema()` | р╕кр╕гр╣Йр╕▓р╕З JSON schema р╕кр╕│р╕лр╕гр╕▒р╕Ъ LLM | `schema <- create_grading_schema()` |

### ЁЯФз р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ Utility р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕е

| р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й |
|---------|----------|----------------|
| `validate_response_data()` | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е input | `validate_response_data(responses)` |
| `init_logger()` | р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ logging р╕гр╕░р╕Ър╕Ъ | `init_logger("logs/app.log", "INFO")` |
| `should_use_parallel()` | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕зр╕гр╣Гр╕Кр╣Й parallel | `if(should_use_parallel(n)) { ... }` |
| `get_optimal_cores()` | р╕лр╕▓р╕Ир╕│р╕Щр╕зр╕Щ cores р╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б | `cores <- get_optimal_cores(nrow(responses))` |

### ЁЯУК р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

| р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й |
|---------|----------|----------------|
| `view_student_results()` | р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ | `view_student_results(results, 1)` |
| `extract_criteria_scores()` | р╣Бр╕вр╕Бр╕Др╕░р╣Бр╕Щр╕Щр╣Бр╕Хр╣Ир╕ер╕░ criterion | `extract_criteria_scores(results)` |
| `debug_per_criterion()` | р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З per_criterion | `debug_per_criterion(results)` |

### ЁЯУД р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Ир╕▒р╕Фр╕Бр╕▓р╕г PDF р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ъ

| р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й |
|---------|----------|----------------|
| `split_pdf_by_question()` | р╣Бр╕вр╕Б PDF р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕кр╕нр╕Ъ | `split_pdf_by_question("exam.pdf", n_questions = 4)` |
| `inspect_pdf_structure()` | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З PDF | `inspect_pdf_structure("exam.pdf", 4)` |

### ЁЯФН р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ OCR р╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╕▓р╕вр╕бр╕╖р╕н

| р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в | р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й |
|---------|----------|----------------|
| `ocr_handwriting()` | р╣Бр╕Ыр╕ер╕Зр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б | `result <- ocr_handwriting("handwriting.jpg")` |
| `ocr_batch_handwriting()` | OCR р╕лр╕ер╕▓р╕вр╣Др╕Яр╕ер╣Мр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ | `results <- ocr_batch_handwriting(image_paths)` |

## ЁЯОи р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З System Prompt

### р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Вр╕нр╕З System Prompt

#### 1. **р╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Ф**
```r
strict_prompt <- "р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╣Бр╕ер╕░р╣Гр╕Кр╣Йр╣Ар╕Бр╕Ур╕Ср╣Мр╕кр╕╣р╕З р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Вр╣Йр╕бр╕Вр╣Йр╕Щр╕Хр╕▓р╕бр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Гр╕Щ rubric р╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Др╕гр╣Ир╕Зр╕Др╕гр╕▒р╕Ф р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕Хр╣Зр╕бр╕Зр╣Ир╕▓р╕вр╣Ж р╕лр╕▓р╕Бр╕Др╕│р╕Хр╕нр╕Ър╣Др╕бр╣Ир╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М"

results <- grade_responses(responses, rubric, key, system_prompt = strict_prompt)
```

#### 2. **р╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╣Гр╕лр╣Йр╕Бр╕│р╕ер╕▒р╕Зр╣Гр╕И**
```r
encouraging_prompt <- "р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕Бр╕│р╕ер╕▒р╕Зр╣Гр╕Ир╣Бр╕ер╕░р╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕гр╕Зр╕Ър╕▒р╕Щр╕Фр╕▓р╕ер╣Гр╕И р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕бр╣Бр╕Хр╣Ир╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╣Ар╕Кр╕┤р╕Зр╕Ър╕зр╕Б р╕Кр╕╡р╣Йр╕Ир╕╕р╕Фр╣Бр╕Вр╣Зр╕Зр╕Бр╣Ир╕нр╕Щр╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З р╣Бр╕ер╕░р╣Гр╕лр╣Йр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣М"

results <- grade_responses(responses, rubric, key, system_prompt = encouraging_prompt)
```

#### 3. **р╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Нр╣Ар╕Йр╕Юр╕▓р╕░р╕Чр╕▓р╕З**
```r
expert_prompt <- "р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕Ьр╕╣р╣Йр╣Ар╕Кр╕╡р╣Ир╕вр╕зр╕Кр╕▓р╕Нр╕Фр╣Йр╕▓р╕Щр╕Бр╕▓р╕гр╕ир╕╢р╕Бр╕йр╕▓р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Ьр╕е р╕бр╕╡р╕Ыр╕гр╕░р╕кр╕Ър╕Бр╕▓р╕гр╕Ур╣Мр╣Гр╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Щр╕Бр╕▓р╕гр╕кр╕нр╕Щр╕бр╕▓р╕Бр╕зр╣Ир╕▓ 15 р╕Ыр╕╡ р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕ер╕╢р╕Бр╣Гр╕Щр╕кр╕▓р╕Вр╕▓р╕зр╕┤р╕Кр╕▓"

results <- grade_responses(responses, rubric, key, system_prompt = expert_prompt)
```

#### 4. **р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Бр╕Ър╕Ър╣Вр╕ор╕ер╕┤р╕кр╕Хр╕┤р╕Б**
```r
holistic_prompt <- "р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕│р╕Хр╕нр╕Ър╕нр╕вр╣Ир╕▓р╕Зр╕гр╕нр╕Ър╕Фр╣Йр╕▓р╕Щ р╕бр╕нр╕Зр╕ар╕▓р╕Юр╕гр╕зр╕бр╕Вр╕нр╕Зр╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Др╕┤р╕Фр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ р╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╣Бр╕Др╣Ир╕Фр╕╣р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕Хр╣Ир╕Фр╕╣р╕Бр╕гр╕░р╕Ър╕зр╕Щр╕Бр╕▓р╕гр╕Др╕┤р╕Фр╕Фр╣Йр╕зр╕в"

results <- grade_responses(responses, rubric, key, system_prompt = holistic_prompt)
```

#### 5. **р╕ар╕▓р╕йр╕▓р╕нр╕▒р╕Зр╕Бр╕др╕й**
```r
english_prompt <- "You are an expert educator specializing in assessment and evaluation. Grade student responses fairly and consistently, providing constructive feedback that promotes learning."

results <- grade_responses(responses, rubric, key, system_prompt = english_prompt)
```

### р╕Бр╕▓р╕гр╕гр╕зр╕б System Prompt р╕Бр╕▒р╕Ъ Parallel Processing

```r
# р╕Бр╕гр╕Ур╕╡р╕бр╕╡р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Б р╣Гр╕Кр╣Й parallel processing р╕Юр╕гр╣Йр╕нр╕б custom prompt
custom_prompt <- "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕бр╣Бр╕ер╕░р╕кр╕бр╣Ир╕│р╣Ар╕кр╕бр╕н р╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╣Гр╕лр╣Й feedback р╕Чр╕╡р╣Ир╕бр╕╡р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М"

large_results <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  system_prompt = custom_prompt,
  .parallel = TRUE,
  .cores = get_optimal_cores(nrow(responses)),
  .progress = TRUE
)
```

## ЁЯдЦЁЯдЦ р╕гр╕░р╕Ър╕Ър╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ъ Multiagent (р╣Гр╕лр╕бр╣И!)

### р╕ар╕▓р╕Юр╕гр╕зр╕б

р╕гр╕░р╕Ър╕Ъ **Multiagent Grading** р╣Ар╕Ыр╣Зр╕Щр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣Мр╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣Ир╣Гр╕Кр╣Й AI 4 р╕Хр╕▒р╕зр╕Чр╕│р╕Зр╕▓р╕Щр╕гр╣Ир╕зр╕бр╕Бр╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╣Гр╕лр╣Йр╕Ьр╕ер╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Чр╕╡р╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕нр╣Бр╕ер╕░р╣Бр╕бр╣Ир╕Щр╕вр╕│р╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕кр╕╣р╕З (high-stakes assessment)

### р╕кр╕Цр╕▓р╕Ыр╕▒р╕Хр╕вр╕Бр╕гр╕гр╕б Multiagent System

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              MULTIAGENT GRADING WORKFLOW                тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

Step 1: Independent Grading
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР                    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   Agent 1    тФВ                    тФВ   Agent 2    тФВ
тФВ  (Conceptual тФВ                    тФВ  (Detail &   тФВ
тФВ   Thinking)  тФВ                    тФВ Completeness)тФВ
тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФШ                    тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФШ
       тФВ                                   тФВ
       тФВ      р╕Ьр╕ер╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И                     тФВ      р╕Ьр╕ер╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И
       тФВ      + р╕Др╕░р╣Бр╕Щр╕Щ                       тФВ      + р╕Др╕░р╣Бр╕Щр╕Щ
       тФВ      + feedback                    тФВ      + feedback
       тФВ                                   тФВ
       тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                    тФВ
                    тЦ╝
         тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
         тФВ     Agent 3      тФВ
         тФВ   (Consistency   тФВ тЧДтФАтФА р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З
         тФВ     Checker)     тФВ
         тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                   тФВ
        тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
        тФВ                     тФВ
   р╣Др╕бр╣Ир╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З             р╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З
   (Re-grade)               тФВ
        тФВ                     тФВ
        тФФтФАтЦ║ р╕Бр╕ер╕▒р╕Ър╣Др╕Ыр╕Хр╕гр╕зр╕Ир╣Гр╕лр╕бр╣И      тФВ
            (р╕кр╣Ир╕З feedback)     тФВ
            max iterations     тФВ
                              тЦ╝
                   тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                   тФВ     Agent 4      тФВ
                   тФВ   (Feedback      тФВ
                   тФВ   Synthesizer)   тФВ
                   тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                             тФВ
                             тЦ╝
                   тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                   тФВ  Final Result    тФВ
                   тФВ  + р╕Др╕░р╣Бр╕Щр╕Щр╕гр╕зр╕б       тФВ
                   тФВ  + feedback       тФВ
                   тФВ  + metadata       тФВ
                   тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### р╕Ър╕Чр╕Ър╕▓р╕Чр╕Вр╕нр╕Зр╣Бр╕Хр╣Ир╕ер╕░ Agent

| Agent | р╕Ър╕Чр╕Ър╕▓р╕Ч | р╕Ир╕╕р╕Фр╣Ар╕Щр╣Йр╕Щ |
|-------|--------|---------|
| **Agent 1** | р╕Ьр╕╣р╣Йр╕Хр╕гр╕зр╕Ир╕Чр╣Ир╕▓р╕Щр╕Чр╕╡р╣И 1 | р╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕Щр╕зр╕Др╕┤р╕Фр╕лр╕ер╕▒р╕Б, р╕Бр╕▓р╕гр╕Др╕┤р╕Фр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М |
| **Agent 2** | р╕Ьр╕╣р╣Йр╕Хр╕гр╕зр╕Ир╕Чр╣Ир╕▓р╕Щр╕Чр╕╡р╣И 2 | р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф, р╕Др╕зр╕▓р╕бр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Др╕│р╕Хр╕нр╕Ъ |
| **Agent 3** | р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З | р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Ьр╕ер╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И, р╣Гр╕лр╣Й feedback р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Гр╕лр╕бр╣И |
| **Agent 4** | р╕кр╕▒р╕Зр╣Ар╕Др╕гр╕▓р╕░р╕лр╣М feedback | р╕гр╕зр╕б feedback р╕Ир╕▓р╕Бр╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕З agent р╣Гр╕лр╣Йр╣Ар╕Ыр╣Зр╕Щ feedback р╣Ар╕Фр╕╡р╕вр╕зр╕Чр╕╡р╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М |

### р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Multiagent Grading

#### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ

```r
library(kruroograder)

# р╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕е
responses <- read_csv("data/responses.csv")
rubric <- load_rubric("rubric/item_001.md")
key <- load_answer_key("rubric/item_001_key.md")

# р╕Хр╕гр╕зр╕Ир╣Бр╕Ър╕Ъ multiagent
results <- grade_responses_multiagent(
  responses = responses,
  rubric = rubric,
  key = key,
  .progress = TRUE
)

# р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
print(results)
```

#### р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╣Др╕Фр╣Й

```r
> head(results)
  student_id item_id total_score agent1_score agent2_score score_difference iterations was_consistent
1        001     001         7.5          7.0          8.0              1.0          1          TRUE
2        002     001         6.0          5.5          6.5              1.0          2         FALSE
3        003     001         8.5          8.5          8.5              0.0          1          TRUE

  overall_feedback                                    grader_agreement_note
1 "р╕Ир╕╕р╕Фр╣Бр╕Вр╣Зр╕З: р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕Щр╕зр╕Др╕┤р╕Фр╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ..."                  "р╕Ьр╕╣р╣Йр╕Хр╕гр╕зр╕Ир╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕Зр╣Ар╕лр╣Зр╕Щр╕Хр╕гр╕Зр╕Бр╕▒р╕Щр╣Гр╕Щр╕ар╕▓р╕Юр╕гр╕зр╕б..."
2 "р╕Др╕зр╕гр╣Ар╕Юр╕┤р╣Ир╕бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Ыр╕гр╕░р╕Бр╕нр╕Ъ..."                        "р╕бр╕╡р╕Др╕зр╕▓р╕бр╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╣Ар╕ер╣Зр╕Бр╕Щр╣Йр╕нр╕вр╣Гр╕Щр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щ..."
```

#### р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З Agent Prompts

```r
# р╕Бр╕│р╕лр╕Щр╕Ф system prompt р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ agent р╣Ар╕Юр╕╖р╣Ир╕нр╕бр╕╕р╕бр╕бр╕нр╕Зр╕Чр╕╡р╣Ир╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ

agent1_prompt <- "
р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Ар╕Щр╣Йр╕Щр╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣Мр╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Ар╕Кр╕┤р╕Зр╕ер╕╢р╕Б
р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╣Вр╕Фр╕вр╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓:
1. р╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╣Бр╕Щр╕зр╕Др╕┤р╕Фр╕лр╕ер╕▒р╕Б
2. р╕Бр╕▓р╕гр╕Др╕┤р╕Фр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Бр╕ер╕░р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕З
3. р╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣Мр╣Гр╕Щр╕Бр╕▓р╕гр╕нр╕Шр╕┤р╕Ър╕▓р╕в
"

agent2_prompt <- "
р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕нр╕▓р╕Ир╕▓р╕гр╕вр╣Мр╕Чр╕╡р╣Ир╣Ар╕Щр╣Йр╕Щр╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╣Вр╕Фр╕вр╕Юр╕┤р╕Ир╕▓р╕гр╕Ур╕▓:
1. р╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
2. р╕Др╕зр╕▓р╕бр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Др╕│р╕Хр╕нр╕Ъ
3. р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕ир╕▒р╕Юр╕Чр╣Мр╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
"

results <- grade_responses_multiagent(
  responses = responses,
  rubric = rubric,
  key = key,
  system_prompt_agent1 = agent1_prompt,
  system_prompt_agent2 = agent2_prompt,
  max_iterations = 3,              # р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Гр╕лр╕бр╣И
  consistency_threshold = 0.15,     # threshold р╕Др╕зр╕▓р╕бр╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╕Др╕░р╣Бр╕Щр╕Щ (15% р╕Вр╕нр╕Зр╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕Хр╣Зр╕б)
  .progress = TRUE
)
```

#### р╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ Agent (р╣Бр╕Щр╕░р╕Щр╕│!)

```r
# ЁЯОп BEST PRACTICE: р╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕ер╕Ф bias р╣Бр╕ер╕░р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕лр╕ер╕▓р╕Бр╕лр╕ер╕▓р╕в
results <- grade_responses_multiagent(
  responses = responses,
  rubric = rubric,
  key = key,

  # Agent 1: р╣Вр╕бр╣Ар╕Фр╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Др╕┤р╕Фр╣Бр╕Ър╕Ъ conceptual
  model_config_agent1 = list(model = "gpt-4o-mini", provider = "openai"),

  # Agent 2: р╣Вр╕бр╣Ар╕Фр╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
  model_config_agent2 = list(model = "gpt-5-nano", provider = "openai"),

  # Agent 3: р╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣Ир╣Бр╕Вр╣Зр╕Зр╣Бр╕Бр╕гр╣Ир╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З
  model_config_agent3 = list(model = "gpt-4o", provider = "openai"),

  # Agent 4: р╣Вр╕бр╣Ар╕Фр╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕▒р╕Зр╣Ар╕Др╕гр╕▓р╕░р╕лр╣М feedback
  model_config_agent4 = list(model = "gpt-4o", provider = "openai"),

  .progress = TRUE
)
```

#### р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З Temperature р╣Бр╕ер╕░ Top_p р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ Agent

```r
# р╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ + р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣Мр╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕лр╕ер╕▓р╕Бр╕лр╕ер╕▓р╕вр╕кр╕╣р╕Зр╕кр╕╕р╕Ф
results <- grade_responses_multiagent(
  responses = responses,
  rubric = rubric,
  key = key,

  # Agent 1: Creative conceptual thinking
  model_config_agent1 = "gpt-4o-mini",
  .temperature_agent1 = 0.7,  # р╕кр╕╣р╕Зр╕Бр╕зр╣Ир╕▓ = р╕Др╕┤р╕Фр╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣Мр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ
  .top_p_agent1 = 0.95,

  # Agent 2: Conservative detail checking
  model_config_agent2 = "gpt-5-nano",
  .temperature_agent2 = 0.3,  # р╕Хр╣Ир╕│р╕Бр╕зр╣Ир╕▓ = р╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╣Бр╕ер╕░р╕кр╕бр╣Ир╕│р╣Ар╕кр╕бр╕нр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ
  .top_p_agent2 = 0.85,

  # Agent 3: Balanced consistency checker
  model_config_agent3 = "gpt-4o",
  .temperature_agent3 = 0.5,  # р╕Бр╕ер╕▓р╕Зр╣Ж = р╕кр╕бр╕Фр╕╕р╕е

  # Agent 4: Synthesis with moderate creativity
  model_config_agent4 = "gpt-4o",
  .temperature_agent4 = 0.6,  # р╕Др╣Ир╕нр╕Щр╕Вр╣Йр╕▓р╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣Мр╣Ар╕Юр╕╖р╣Ир╕н feedback р╕Чр╕╡р╣Ир╕Фр╕╡

  max_iterations = 3,
  .progress = TRUE
)
```

#### Multiagent + Parallel Processing

```r
# р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Б р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ
results <- grade_responses_multiagent(
  responses = large_responses,
  rubric = rubric,
  key = key,
  model_config_agent1 = "gpt-4o-mini",
  model_config_agent2 = "gpt-5-nano",
  model_config_agent3 = "gpt-4o",
  model_config_agent4 = "gpt-4o",
  .parallel = TRUE,
  .cores = 4,
  .progress = TRUE
)
```

### р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣Мр╕кр╕│р╕Др╕▒р╕Н

| р╕Юр╕▓р╕гр╕▓р╕бр╕┤р╣Ар╕Хр╕нр╕гр╣М | р╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в |
|------------|------------|----------|
| `max_iterations` | 2 | р╕Ир╕│р╕Щр╕зр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Гр╕лр╕бр╣Ир╣Ар╕бр╕╖р╣Ир╕нр╕Ьр╕ер╣Др╕бр╣Ир╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З |
| `consistency_threshold` | 0.2 | р╣Ар╕Бр╕Ур╕Ср╣Мр╕Др╕зр╕▓р╕бр╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╕Др╕░р╣Бр╕Щр╕Щ (р╕кр╕▒р╕бр╕Юр╕▒р╕Чр╕Шр╣Мр╕Бр╕▒р╕Ър╕Др╕░р╣Бр╕Щр╕Щр╣Ар╕Хр╣Зр╕б) |
| `system_prompt_agent1` | р╕бр╕╕р╕бр╕бр╕нр╕Зр╣Бр╕Щр╕зр╕Др╕┤р╕Ф | system prompt р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent р╕Хр╕▒р╕зр╕Чр╕╡р╣И 1 |
| `system_prompt_agent2` | р╕бр╕╕р╕бр╕бр╕нр╕Зр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф | system prompt р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent р╕Хр╕▒р╕зр╕Чр╕╡р╣И 2 |
| `model_config_agent1` | NULL (р╣Гр╕Кр╣Й model_config) | Model config р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent 1 |
| `model_config_agent2` | NULL (р╣Гр╕Кр╣Й model_config) | Model config р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent 2 |
| `model_config_agent3` | NULL (р╣Гр╕Кр╣Й model_config) | Model config р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent 3 |
| `model_config_agent4` | NULL (р╣Гр╕Кр╣Й model_config) | Model config р╕кр╕│р╕лр╕гр╕▒р╕Ъ agent 4 |
| `.temperature_agent1-4` | NULL (р╣Гр╕Кр╣Й .temperature) | Temperature р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ agent |
| `.top_p_agent1-4` | NULL (р╣Гр╕Кр╣Й .top_p) | Top_p р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ agent |

### р╕Бр╕▓р╕гр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М Multiagent

```r
# р╕кр╕гр╕╕р╕Ыр╕Др╕зр╕▓р╕бр╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З
cat("Consistent grading:", sum(results$was_consistent), "out of", nrow(results), "\n")
cat("Average score difference:", round(mean(results$score_difference), 2), "\n")

# р╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕кр╕╣р╕З
high_disagreement <- results %>%
  filter(score_difference > 2) %>%
  select(student_id, agent1_score, agent2_score, score_difference, grader_agreement_note)

print(high_disagreement)

# р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Др╕░р╣Бр╕Щр╕Щр╕Ир╕▓р╕Бр╣Бр╕Хр╣Ир╕ер╕░ agent
results %>%
  select(student_id, agent1_score, agent2_score, total_score) %>%
  mutate(
    avg_agent_score = (agent1_score + agent2_score) / 2,
    synthesis_adjustment = total_score - avg_agent_score
  )
```

### р╕Вр╣Йр╕нр╕Фр╕╡р╕Вр╕нр╕З Multiagent Grading

| р╕Вр╣Йр╕нр╕Фр╕╡ | р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в |
|------|----------|
| ЁЯОп **р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕нр╕кр╕╣р╕З** | р╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕Ир╕▓р╕Бр╕лр╕ер╕▓р╕вр╕бр╕╕р╕бр╕бр╕нр╕Зр╕ер╕Фр╕нр╕Др╕Хр╕┤р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф |
| ЁЯФД **Quality Control** | Agent 3 р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕Зр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ |
| ЁЯФБ **Iterative Refinement** | р╕Хр╕гр╕зр╕Ир╣Гр╕лр╕бр╣Ир╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╣Ар╕бр╕╖р╣Ир╕нр╕Юр╕Ър╕Др╕зр╕▓р╕бр╣Др╕бр╣Ир╕кр╕нр╕Фр╕Др╕ер╣Йр╕нр╕З |
| ЁЯТб **Feedback р╕Чр╕╡р╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ** | р╕гр╕зр╕б insight р╕Ир╕▓р╕Бр╕лр╕ер╕▓р╕в perspective |
| ЁЯУК **Metadata р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ** | р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╣Бр╕ер╕░р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З |

### р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕лр╕гр╣Ир╕Др╕зр╕гр╣Гр╕Кр╣Й Multiagent

тЬЕ **р╕Др╕зр╕гр╣Гр╕Кр╣Йр╣Ар╕бр╕╖р╣Ир╕н:**
- р╕Вр╣Йр╕нр╕кр╕нр╕Ър╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕кр╕╣р╕З (midterm, final exam)
- р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕нр╕кр╕╣р╕З
- р╕Вр╣Йр╕нр╕кр╕нр╕Ър╕бр╕╡р╕Др╕зр╕▓р╕бр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щ р╕бр╕╡р╕лр╕ер╕▓р╕вр╕бр╕┤р╕Хр╕┤р╣Гр╕Щр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щ
- р╕бр╕╡р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕У API р╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н (р╣Гр╕Кр╣Й API calls р╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ single-agent 2-4 р╣Ар╕Чр╣Ир╕▓)

тЭМ **р╣Др╕бр╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╣Ар╕бр╕╖р╣Ир╕н:**
- р╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Зр╣Ир╕▓р╕в р╕бр╕╡р╣Ар╕Бр╕Ур╕Ср╣Мр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ
- quiz р╕Чр╕▒р╣Ир╕зр╣Др╕Ы р╕лр╕гр╕╖р╕нр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕гр╕▓р╕вр╕зр╕▒р╕Щ
- р╕Зр╕Ър╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Ир╕│р╕Бр╕▒р╕Ф
- р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕зр╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б

### р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕лр╕вр╕▒р╕Фр╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ

```r
# р╣Гр╕Кр╣Й multiagent р╣Ар╕Йр╕Юр╕▓р╕░р╕Вр╣Йр╕нр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╕кр╕╣р╕З
high_stake_responses <- responses %>% filter(item_type == "essay")
quiz_responses <- responses %>% filter(item_type == "quiz")

# High-stake: р╣Гр╕Кр╣Й multiagent
essay_results <- grade_responses_multiagent(high_stake_responses, rubric, key)

# Quiz: р╣Гр╕Кр╣Й single-agent
quiz_results <- grade_responses(quiz_responses, rubric, key)

# р╕гр╕зр╕бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
all_results <- bind_rows(essay_results, quiz_results)
```

### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З

р╕Фр╕╣р╣Др╕Яр╕ер╣М `example_multiagent.R` р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:
```r
source("example_multiagent.R")
```

## ЁЯУД р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣М PDF р╣Бр╕ер╕░ OCR

### р╕Бр╕▓р╕гр╣Бр╕вр╕Б PDF р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕кр╕нр╕Ъ

kruroograder р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕вр╕Бр╣Др╕Яр╕ер╣М PDF р╕Чр╕╡р╣Ир╕бр╕╡р╕Бр╕гр╕░р╕Фр╕▓р╕йр╕Др╕│р╕Хр╕нр╕Ър╕лр╕ер╕▓р╕вр╕Др╕Щр╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щр╣Др╕Яр╕ер╣Мр╣Бр╕вр╕Бр╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕кр╕нр╕Ъ р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕гр╕Ур╕╡р╕Чр╕╡р╣Ир╕кр╣Бр╕Бр╕Щр╕Бр╕гр╕░р╕Фр╕▓р╕йр╕Др╕│р╕Хр╕нр╕Ър╣Бр╕Ър╕Ър╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ъ:

```r
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕З PDF р╕Бр╣Ир╕нр╕Щ
inspect_pdf_structure("exam_scanned.pdf", n_questions = 4)

# р╣Бр╕вр╕Б PDF р╣Ар╕Ыр╣Зр╕Щр╣Др╕Яр╕ер╣Мр╕Хр╕▓р╕бр╕Вр╣Йр╕н
result <- split_pdf_by_question(
  input_pdf = "exam_scanned.pdf",
  n_questions = 4,
  out_dir = "separated_questions",
  filename_prefix = "Q",
  filename_suffix = "_all.pdf",
  dry_run = FALSE,       # р╕Хр╕▒р╣Йр╕Зр╣Ар╕Ыр╣Зр╕Щ TRUE р╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕Фр╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щ
  overwrite = TRUE
)

# р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
print(result$summary)
```

#### р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Output:
```
р╕Бр╕│р╕ер╕▒р╕Зр╣Бр╕вр╕Б PDF р╣Ар╕Ыр╣Зр╕Щ 4 р╣Др╕Яр╕ер╣М...
тЬУ р╕кр╕гр╣Йр╕▓р╕З Q1_all.pdf (25 р╕лр╕Щр╣Йр╕▓)
тЬУ р╕кр╕гр╣Йр╕▓р╕З Q2_all.pdf (25 р╕лр╕Щр╣Йр╕▓)  
тЬУ р╕кр╕гр╣Йр╕▓р╕З Q3_all.pdf (25 р╕лр╕Щр╣Йр╕▓)
тЬУ р╕кр╕гр╣Йр╕▓р╕З Q4_all.pdf (25 р╕лр╕Щр╣Йр╕▓)
```

### р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ OCR р╕кр╕│р╕лр╕гр╕▒р╕Ър╕ер╕▓р╕вр╕бр╕╖р╕н

р╕гр╕░р╕Ър╕Ъ kruroograder р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ыр╕ер╕Зр╕ер╕▓р╕вр╕бр╕╖р╕нр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Вр╕Фр╕вр╣Гр╕Кр╣Й OpenAI Vision API р╕Лр╕╢р╣Ир╕Зр╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╣Ар╕Вр╕╡р╕вр╕Щр╕Фр╣Йр╕зр╕вр╕ер╕▓р╕вр╕бр╕╖р╕н

#### ЁЯОп р╕Др╕╕р╕Ур╕кр╕бр╕Ър╕▒р╕Хр╕┤р╕Вр╕нр╕З OCR System

- **р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕ар╕▓р╕Юр╕лр╕ер╕▓р╕вр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ**: JPG, PNG, JPEG, GIF, WebP
- **р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Бр╕Ър╕Ъ Batch**: р╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕ар╕▓р╕Юр╕лр╕ер╕▓р╕вр╣Др╕Яр╕ер╣Мр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ
- **р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З System Prompt р╣Др╕Фр╣Й**: р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╕Бр╕▒р╕Фр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ър╕Ър╣Ар╕Йр╕Юр╕▓р╕░р╕Чр╕▓р╕З
- **р╕Ир╕▒р╕Фр╕Бр╕▓р╕г Rate Limiting**: р╕бр╕╡р╕Бр╕▓р╕гр╕лр╕Щр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Б API
- **Error Handling**: р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Бр╕ер╕░р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Др╕бр╣Ир╣Др╕Фр╣Й
- **Progress Tracking**: р╣Бр╕кр╕Фр╕Зр╕Др╕зр╕▓р╕бр╕Др╕╖р╕Ър╕лр╕Щр╣Йр╕▓р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е

#### ЁЯФз р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕Ър╕╖р╣Йр╕нр╕Зр╕Хр╣Йр╕Щ

```r
# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ OpenAI API Key
Sys.setenv(OPENAI_API_KEY = "your-openai-api-key")

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓
if (Sys.getenv("OPENAI_API_KEY") == "") {
  stop("р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ OPENAI_API_KEY")
}

# р╣Вр╕лр╕ер╕Фр╣Бр╕Юр╣Зр╕Бр╣Ар╕Бр╕Ир╕Чр╕╡р╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ
library(kruroograder)
library(dplyr)
library(readr)
```

#### ЁЯУ╕ OCR р╣Др╕Яр╕ер╣Мр╣Ар╕Фр╕╡р╣Ир╕вр╕з

```r
# OCR р╣Др╕Яр╕ер╣Мр╣Ар╕Фр╕╡р╣Ир╕вр╕зр╣Бр╕Ър╕Ър╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ
result <- ocr_handwriting(
  image_path = "student_answer.jpg"
)

# р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
cat("р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕кр╕Бр╕▒р╕Фр╣Др╕Фр╣Й:\n", result$answer)
cat("\nр╕кр╕Цр╕┤р╕Хр╕┤р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:\n")
cat("- Prompt tokens:", result$prompt_tokens, "\n")
cat("- Completion tokens:", result$completion_tokens, "\n")
cat("- р╕гр╕зр╕б tokens:", result$tokens_used, "\n")
```

#### ЁЯОи р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З System Prompt р╕кр╕│р╕лр╕гр╕▒р╕Ъ OCR

```r
# р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М
math_prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Чр╕▓р╕Зр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н р╕гр╕зр╕бр╕Цр╕╢р╕Зр╕кр╕╣р╕Хр╕г р╕кр╕бр╕Бр╕▓р╕г р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У 
р╣Гр╕лр╣Йр╕гр╕░р╕зр╕▒р╕Зр╣Ар╕ер╕Вр╣Бр╕ер╕░р╕кр╕▒р╕Нр╕ер╕▒р╕Бр╕йр╕Ур╣Мр╕Чр╕▓р╕Зр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М р╣Ар╕Кр╣Ир╕Щ +, -, ├Ч, ├╖, =, тИЪ р╣Гр╕лр╣Йр╣Бр╕бр╣Ир╕Щр╕вр╕│"

math_result <- ocr_handwriting(
  image_path = "math_answer.jpg",
  system_prompt = math_prompt,
  model_config = "gpt-4o"  # р╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣Ир╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Бр╕зр╣Ир╕▓
)

# р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣М
science_prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ:
- р╕Др╕│р╕ир╕▒р╕Юр╕Чр╣Мр╕Чр╕▓р╕Зр╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣М
- р╕Кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Ар╕Др╕бр╕╡ р╣Бр╕ер╕░р╕кр╕╣р╕Хр╕гр╣Ар╕Др╕бр╕╡
- р╕лр╕Щр╣Ир╕зр╕вр╕Бр╕▓р╕гр╕зр╕▒р╕Ф р╣Ар╕Кр╣Ир╕Щ р╕бр╕Б., р╕ер╕┤р╕Хр╕г, р╣Ар╕Лр╕ер╣Ар╕Лр╕╡р╕вр╕к
- р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕З"

science_result <- ocr_handwriting(
  image_path = "science_answer.jpg",
  system_prompt = science_prompt
)

# р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в
thai_prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕ар╕▓р╕йр╕▓р╣Др╕Чр╕вр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ:
- р╕Бр╕▓р╕гр╕кр╕░р╕Бр╕Фр╕Др╕│р╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕зр╕гр╕гр╕Др╕Хр╕нр╕Щ
- р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╣Др╕бр╣Йр╕лр╕▒р╕Щр╕нр╕▓р╕Бр╕▓р╕и р╣Др╕бр╣Йр╣Др╕Хр╣Ир╕Др╕╣р╣Й
- р╕Др╕зр╕▓р╕бр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Ыр╕гр╕░р╣Вр╕вр╕Д"

thai_result <- ocr_handwriting(
  image_path = "thai_answer.jpg",
  system_prompt = thai_prompt
)
```

#### ЁЯФД OCR р╕лр╕ер╕▓р╕вр╣Др╕Яр╕ер╣Мр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ (Batch Processing)

```r
# р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣М
image_dir <- "student_images"
image_files <- list.files(image_dir, 
                         pattern = "\\.(jpg|jpeg|png)$", 
                         full.names = TRUE)

cat("р╕Юр╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю", length(image_files), "р╣Др╕Яр╕ер╣М\n")

# OCR р╣Бр╕Ър╕Ъ batch р╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
batch_results <- ocr_batch_handwriting(
  image_paths = image_files,
  batch_size = 5,                    # р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕Чр╕╡р╕ер╕░ 5 р╣Др╕Яр╕ер╣М
  system_prompt = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Бр╕ер╕░р╣Бр╕бр╣Ир╕Щр╕вр╕│ 
                  р╣Др╕бр╣Ир╣Ар╕нр╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╣Ар╕Вр╕╡р╕вр╕Щр╕зр╣Ир╕▓ 'р╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕нр╕Ър╕Др╕│р╕Цр╕▓р╕б' р╕лр╕гр╕╖р╕нр╕Др╕│р╣Бр╕Щр╕░р╕Щр╕│р╕нр╕╖р╣Ир╕Щр╣Ж",
  delay_seconds = 3,                 # р╕лр╕Щр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓ 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╣Др╕Яр╕ер╣М
  progress = TRUE,                   # р╣Бр╕кр╕Фр╕З progress bar
  save_intermediate = TRUE,          # р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Чр╕▓р╕З
  model_config = "gpt-4o-mini",
  max_tokens = 800
)

# р╕Фр╕╣р╕кр╕гр╕╕р╕Ыр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
print(batch_results)
```

#### ЁЯУК р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М OCR:

```r
> head(batch_results, 3)
# A tibble: 3 ├Ч 7
  image_file     answer                          prompt_tokens completion_tokens tokens_used model_used  processed_at       
  <chr>          <chr>                                   <int>             <int>       <int> <chr>       <dttm>            
1 student001.jpg "р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕Ир╕бр╕╡р╕ДтАж"            850               120         970 gpt-4o-mini 2024-10-11 14:30:45
2 student002.jpg "р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Хр╣Ир╕нр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕ктАж"             780               95          875 gpt-4o-mini 2024-10-11 14:30:48  
3 student003.jpg "р╣Гр╕Щр╕вр╕╕р╕Др╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Ыр╣Зр╕Щр╕кр╕┤р╣Ир╕ЗтАж"              920               135        1055 gpt-4o-mini 2024-10-11 14:30:51

> # р╕кр╕Цр╕┤р╕Хр╕┤р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
> summarise(batch_results,
+   total_images = n(),
+   total_tokens = sum(tokens_used),
+   avg_tokens_per_image = mean(tokens_used),
+   total_cost_estimate = total_tokens * 0.00015 / 1000  # р╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Бр╕▓р╕гр╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕в
+ )
# A tibble: 1 ├Ч 4
  total_images total_tokens avg_tokens_per_image total_cost_estimate
         <int>        <int>                <dbl>               <dbl>
1           25        24500                  980               0.037
```

#### ЁЯФН р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Ю OCR

```r
# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Ю OCR
check_ocr_quality <- function(ocr_results) {
  cat("=== р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕╕р╕Ур╕ар╕▓р╕Ю OCR ===\n")
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕Др╕│р╕Хр╕нр╕Ъ
  answer_lengths <- nchar(ocr_results$answer)
  cat("р╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕Др╕│р╕Хр╕нр╕Ъ:\n")
  cat("  - р╣Ар╕Йр╕ер╕╡р╣Ир╕в:", round(mean(answer_lengths)), "р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г\n")
  cat("  - р╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Ф:", min(answer_lengths), "р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г\n")
  cat("  - р╕бр╕▓р╕Бр╕кр╕╕р╕Ф:", max(answer_lengths), "р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г\n")
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕кр╕▒р╣Йр╕Щр╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤ (р╕нр╕▓р╕Ир╣Ар╕Ыр╣Зр╕Щ OCR error)
  short_answers <- which(answer_lengths < 20)
  if (length(short_answers) > 0) {
    cat("\nтЪая╕П  р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕кр╕▒р╣Йр╕Щр╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤ (< 20 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):\n")
    for (i in short_answers) {
      cat("  -", ocr_results$image_file[i], ":", ocr_results$answer[i], "\n")
    }
  }
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Гр╕Кр╣Й tokens
  cat("\nр╕Бр╕▓р╕гр╣Гр╕Кр╣Й tokens:\n")
  cat("  - р╣Ар╕Йр╕ер╕╡р╣Ир╕в:", round(mean(ocr_results$tokens_used)), "tokens/р╕ар╕▓р╕Ю\n")
  cat("  - р╕гр╕зр╕бр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф:", sum(ocr_results$tokens_used), "tokens\n")
  
  return(invisible(ocr_results))
}

# р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
check_ocr_quality(batch_results)
```

#### ЁЯТб р╣Ар╕Чр╕Др╕Щр╕┤р╕Др╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Др╕╕р╕Ур╕ар╕▓р╕Ю OCR

```r
# 1. р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щ
simple_ocr <- function(image_path) {
  ocr_handwriting(image_path, model_config = "gpt-4o-mini")  # р╣Ар╕гр╣Зр╕з, р╕Ыр╕гр╕░р╕лр╕вр╕▒р╕Ф
}

complex_ocr <- function(image_path) {
  ocr_handwriting(image_path, model_config = "gpt-4o")       # р╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Бр╕зр╣Ир╕▓
}

# 2. р╕Бр╕▓р╕гр╣Гр╕Кр╣Й System Prompt р╣Ар╕Йр╕Юр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕кр╕нр╕Ър╣Бр╕Хр╣Ир╕ер╕░р╕Ыр╕гр╕░р╣Ар╕ар╕Ч
create_subject_prompt <- function(subject) {
  prompts <- list(
    math = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ър╕Хр╕▒р╕зр╣Ар╕ер╕В р╕кр╕╣р╕Хр╕г р╣Бр╕ер╕░р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕в",
    science = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣М р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ър╕Др╕│р╕ир╕▒р╕Юр╕Чр╣Мр╣Ар╕Йр╕Юр╕▓р╕░р╣Бр╕ер╕░р╕лр╕Щр╣Ир╕зр╕в", 
    thai = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕ар╕▓р╕йр╕▓р╣Др╕Чр╕в р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╕░р╕Бр╕Фр╣Бр╕ер╕░р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕зр╕гр╕гр╕Др╕Хр╕нр╕Щ",
    english = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕ар╕▓р╕йр╕▓р╕нр╕▒р╕Зр╕Бр╕др╕й р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ grammar р╣Бр╕ер╕░ spelling",
    social = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕кр╕▒р╕Зр╕Др╕бр╕ир╕╢р╕Бр╕йр╕▓ р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ър╕Кр╕╖р╣Ир╕нр╕кр╕Цр╕▓р╕Щр╕Чр╕╡р╣И р╕зр╕▒р╕Щр╕Чр╕╡р╣И р╣Бр╕ер╕░р╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╕Ур╣М"
  )
  return(prompts[[subject]] %||% "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ")
}

# р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
math_results <- ocr_batch_handwriting(
  image_paths = math_images,
  system_prompt = create_subject_prompt("math")
)
```

#### ЁЯЪА Workflow р╕Др╕гр╕Ър╕зр╕Зр╕Ир╕г: OCR + р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ъ

```r
# ========== р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е ==========
library(kruroograder)
library(dplyr)
library(stringr)

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ API
Sys.setenv(OPENAI_API_KEY = "your-api-key")

# р╣Вр╕лр╕ер╕Ф rubric р╣Бр╕ер╕░ answer key
rubric <- load_rubric("rubric/item_006_rubric.md")
answer_key <- load_answer_key("rubric/item_006_key.md")

# ========== р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: OCR р╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н ==========
image_dir <- "student_handwriting/"
image_files <- list.files(image_dir, pattern = "\\.(jpg|png)$", full.names = TRUE)

# р╕Бр╕│р╕лр╕Щр╕Ф system prompt р╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕┤р╕Кр╕▓р╕Чр╕╡р╣Ир╕Хр╕гр╕зр╕И
subject_prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Гр╕Щр╕зр╕┤р╕Кр╕▓р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕Бр╕▓р╕гр╕Хр╕▒р╕Фр╕кр╕┤р╕Щр╣Гр╕И 
р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ:
- р╣Бр╕Щр╕зр╕Др╕┤р╕Фр╣Бр╕ер╕░р╕Чр╕др╕йр╕Ор╕╡р╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕З
- р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Бр╕▓р╕гр╕нр╕Шр╕┤р╕Ър╕▓р╕в  
- р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╣Ар╕Вр╣Йр╕▓р╕Фр╣Йр╕зр╕вр╕Бр╕▒р╕Щ
р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕нр╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Щр╕░р╕Щр╕│р╕лр╕гр╕╖р╕нр╕кр╣Ир╕зр╕Щр╕лр╕▒р╕зр╕Вр╕нр╕Зр╕Бр╕гр╕░р╕Фр╕▓р╕йр╕бр╕▓"

# OCR р╣Бр╕Ър╕Ъ batch
cat("ЁЯФН р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕г OCR р╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н...\n")
ocr_results <- ocr_batch_handwriting(
  image_paths = image_files,
  batch_size = 8,
  system_prompt = subject_prompt,
  delay_seconds = 2,
  progress = TRUE,
  save_intermediate = TRUE,
  model_config = "gpt-4o-mini"
)

cat("тЬЕ OCR р╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Др╕Фр╣Й", nrow(ocr_results), "р╣Др╕Яр╕ер╣М\n")

# ========== р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 3: р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И ==========
# р╣Бр╕Ыр╕ер╕Зр╕Ьр╕е OCR р╣Ар╕Ыр╣Зр╕Щр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Чр╕╡р╣И grade_responses() р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
responses_from_ocr <- ocr_results %>%
  mutate(
    # р╕кр╕Бр╕▒р╕Ф student_id р╕Ир╕▓р╕Бр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М (р╣Ар╕Кр╣Ир╕Щ student_001.jpg -> 001)
    student_id = str_extract(image_file, "\\d+"),
    item_id = "item_006",                    # р╕гр╕лр╕▒р╕кр╕Вр╣Йр╕нр╕кр╕нр╕Ъ
    response_text = answer,                  # р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣И OCR р╣Др╕Фр╣Й
    question_text = rubric$question          # р╕Др╕│р╕Цр╕▓р╕б
  ) %>%
  select(student_id, item_id, response_text, question_text) %>%
  filter(!is.na(student_id), nchar(response_text) > 10)  # р╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Др╕бр╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М

cat("ЁЯУЭ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Др╕Фр╣Й", nrow(responses_from_ocr), "р╕гр╕▓р╕вр╕Бр╕▓р╕г\n")

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
validate_response_data(responses_from_ocr)

# ========== р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 4: р╕Хр╕гр╕зр╕Ир╣Бр╕ер╕░р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ ==========
cat("ЁЯдЦ р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в AI...\n")

grading_results <- grade_responses(
  responses = responses_from_ocr,
  rubric = rubric,
  key = answer_key,
  system_prompt = "р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕бр╕▓р╕Ир╕▓р╕Б OCR р╣Вр╕Фр╕вр╕Др╕│р╕Щр╕╢р╕Зр╕зр╣Ир╕▓р╕нр╕▓р╕Ир╕бр╕╡р╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕кр╕Бр╕▒р╕Фр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б 
                  р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ър╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓р╕Бр╕▓р╕гр╕кр╕░р╕Бр╕Фр╕Чр╕╡р╣Ир╣Бр╕бр╣Ир╕Щр╕вр╕│",
  .parallel = should_use_parallel(nrow(responses_from_ocr)),
  .cores = get_optimal_cores(nrow(responses_from_ocr)),
  .progress = TRUE,
  model_config = "gpt-4o-mini"
)

cat("тЬЕ р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ!\n")

# ========== р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 5: р╕гр╕зр╕бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Бр╕ер╕░р╕кр╣Ир╕Зр╕нр╕нр╕Б ==========
# р╕гр╕зр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е OCR р╣Бр╕ер╕░р╕Ьр╕ер╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И
final_results <- grading_results %>%
  left_join(
    ocr_results %>% 
      select(image_file, tokens_used_ocr = tokens_used, processed_at), 
    by = c("student_id" = str_extract(ocr_results$image_file, "\\d+"))
  )

# р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕кр╕гр╕╕р╕Ы
summary_report <- final_results %>%
  summarise(
    total_students = n(),
    mean_score = round(mean(total_score, na.rm = TRUE), 2),
    median_score = median(total_score, na.rm = TRUE),
    min_score = min(total_score, na.rm = TRUE),
    max_score = max(total_score, na.rm = TRUE),
    total_ocr_tokens = sum(tokens_used_ocr, na.rm = TRUE),
    estimated_cost = round(total_ocr_tokens * 0.00015 / 1000, 4)
  )

print(summary_report)

# р╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
export_results(final_results, "output/ocr_grading_results.xlsx", 
               format = "xlsx", include_feedback = TRUE)

# р╕кр╕гр╣Йр╕▓р╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И
create_grading_report(final_results, "output/ocr_grading_report.md")

cat("ЁЯУК р╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в!\n")
```

#### ЁЯУИ р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Др╕╕р╕Ур╕ар╕▓р╕Ю

```r
# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Др╕│р╕Хр╕нр╕Ъ OCR р╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╕Юр╕┤р╕бр╕Юр╣М
compare_ocr_manual <- function(ocr_text, manual_text) {
  # р╕Др╕│р╕Щр╕зр╕Ур╕Др╕зр╕▓р╕бр╕Др╕ер╣Йр╕▓р╕вр╕Др╕ер╕╢р╕З (simple similarity)
  similarity <- 1 - adist(ocr_text, manual_text) / max(nchar(ocr_text), nchar(manual_text))
  
  list(
    similarity = round(similarity, 3),
    ocr_length = nchar(ocr_text),
    manual_length = nchar(manual_text),
    length_diff = abs(nchar(ocr_text) - nchar(manual_text))
  )
}

# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕▓ OCR errors р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в
analyze_ocr_errors <- function(ocr_results) {
  errors <- list()
  
  # р╕Др╕│р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╣Гр╕Щр╕Бр╕▓р╕г OCR
  problematic_patterns <- c(
    "р╕Бр╕│р╕ер╕▒р╕З" = c("р╕Бр╕▓р╕ер╕▒р╕З", "р╕Бр╕▓р╕гр╕▒р╕З", "р╕Бр╕│р╕гр╣Ир╕З"),
    "р╕Др╕зр╕▓р╕б" = c("р╕Гр╕зр╕▓р╕б", "р╕Д р╕з р╕▓р╕б", "р╕Др╕зр╕▓р╕б"),
    "р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З" = c("р╕Хр╕▒р╕зр╕нр╕в р╕▓р╕З", "р╕Хр╕▒р╕зр╕нр╕вр╕▓р╕З", "р╕Хр╕▒ р╕з р╕н р╕вр╣И р╕▓ р╕З"),
    "р╕Вр╣Йр╕нр╕бр╕╣р╕е" = c("р╕В р╕нр╕бр╕╣р╕е", "р╕Вр╕нр╕бр╕╣р╕е", "р╕Вр╣Йр╕н р╕бр╕╣р╕е")
  )
  
  for (correct in names(problematic_patterns)) {
    wrong_versions <- problematic_patterns[[correct]]
    for (wrong in wrong_versions) {
      count <- sum(grepl(wrong, ocr_results$answer, fixed = TRUE))
      if (count > 0) {
        errors[[paste(wrong, "->", correct)]] <- count
      }
    }
  }
  
  return(errors)
}

# р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕нр╕Вр╕нр╕З OCR
assess_ocr_reliability <- function(ocr_results) {
  cat("=== р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕н OCR ===\n")
  
  # р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣Мр╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕Др╕│р╕Хр╕нр╕Ъ
  answer_lengths <- nchar(ocr_results$answer)
  
  cat("ЁЯУП р╕кр╕Цр╕┤р╕Хр╕┤р╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕Др╕│р╕Хр╕нр╕Ъ:\n")
  cat("   р╣Ар╕Йр╕ер╕╡р╣Ир╕в:", round(mean(answer_lengths)), "р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г\n")
  cat("   р╕кр╣Ир╕зр╕Щр╣Ар╕Ър╕╡р╣Ир╕вр╕Зр╣Ар╕Ър╕Щр╕бр╕▓р╕Хр╕гр╕Рр╕▓р╕Щ:", round(sd(answer_lengths)), "\n")
  
  # р╕лр╕▓р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤
  outliers <- which(answer_lengths < quantile(answer_lengths, 0.1) | 
                   answer_lengths > quantile(answer_lengths, 0.9))
  
  if (length(outliers) > 0) {
    cat("\nтЪая╕П  р╕Др╕│р╕Хр╕нр╕Ър╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓ OCR:\n")
    for (i in outliers[1:min(5, length(outliers))]) {
      cat("   -", ocr_results$image_file[i], 
          "(", answer_lengths[i], "р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г):\n")
      cat("     ", substr(ocr_results$answer[i], 1, 100), "...\n")
    }
  }
  
  # р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М errors р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в
  errors <- analyze_ocr_errors(ocr_results)
  if (length(errors) > 0) {
    cat("\nЁЯФН р╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф OCR р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в:\n")
    for (error in names(errors)) {
      cat("   -", error, ":", errors[[error]], "р╕Др╕гр╕▒р╣Йр╕З\n")
    }
  }
  
  return(invisible(list(lengths = answer_lengths, errors = errors)))
}

# р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
reliability_check <- assess_ocr_reliability(batch_results)
```

#### ЁЯТ░ р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ OCR

```r
# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Др╕│р╕Щр╕зр╕Ур╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ
calculate_ocr_cost <- function(ocr_results, 
                              cost_per_1k_tokens = 0.00015) {  # р╕гр╕▓р╕Др╕▓ gpt-4o-mini
  
  total_tokens <- sum(ocr_results$tokens_used, na.rm = TRUE)
  total_cost <- total_tokens * cost_per_1k_tokens / 1000
  cost_per_image <- total_cost / nrow(ocr_results)
  
  cat("ЁЯТ░ р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ OCR\n")
  cat("   р╕Ир╕│р╕Щр╕зр╕Щр╕ар╕▓р╕Ю:", nrow(ocr_results), "р╕ар╕▓р╕Ю\n")
  cat("   р╕гр╕зр╕б tokens:", format(total_tokens, big.mark = ","), "tokens\n")
  cat("   р╕Хр╣Йр╕Щр╕Чр╕╕р╕Щр╕гр╕зр╕б: $", round(total_cost, 4), "\n")
  cat("   р╕Хр╣Йр╕Щр╕Чр╕╕р╕Щр╕Хр╣Ир╕нр╕ар╕▓р╕Ю: $", round(cost_per_image, 4), "\n")
  cat("   р╕Хр╣Йр╕Щр╕Чр╕╕р╕Щр╕Хр╣Ир╕нр╕ар╕▓р╕Ю:", round(cost_per_image * 35, 2), "р╕Ър╕▓р╕Ч (р╕Ыр╕гр╕░р╕бр╕▓р╕У)\n")
  
  return(list(
    total_cost = total_cost,
    cost_per_image = cost_per_image,
    total_tokens = total_tokens
  ))
}

# р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Хр╣Йр╕Щр╕Чр╕╕р╕Щр╣Вр╕бр╣Ар╕Фр╕ер╕Хр╣Ир╕▓р╕Зр╣Ж
compare_model_costs <- function(n_images, avg_tokens_per_image = 1000) {
  models <- list(
    "gpt-4o-mini" = 0.00015,
    "gpt-4o" = 0.0025,
    "gpt-4-turbo" = 0.001
  )
  
  cat("ЁЯУК р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕Хр╣Йр╕Щр╕Чр╕╕р╕Щр╣Вр╕бр╣Ар╕Фр╕е (", n_images, "р╕ар╕▓р╕Ю):\n")
  
  for (model in names(models)) {
    total_tokens <- n_images * avg_tokens_per_image
    cost <- total_tokens * models[[model]] / 1000
    cat("   ", model, ": $", round(cost, 4), 
        " (", round(cost * 35, 2), " р╕Ър╕▓р╕Ч)\n")
  }
}

# р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
cost_analysis <- calculate_ocr_cost(batch_results)
compare_model_costs(100)  # р╕кр╕│р╕лр╕гр╕▒р╕Ъ 100 р╕ар╕▓р╕Ю
```

#### тЪб Best Practices р╕кр╕│р╕лр╕гр╕▒р╕Ъ OCR

```r
# 1. тЬЕ р╕Бр╕▓р╕гр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕ар╕▓р╕Юр╕Чр╕╡р╣Ир╕Фр╕╡
prepare_images_for_ocr <- function(image_dir) {
  cat("ЁЯУЛ р╣Ар╕Кр╣Зр╕Др╕ер╕┤р╕кр╕Хр╣Мр╕Бр╕▓р╕гр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕ар╕▓р╕Ю:\n")
  cat("   тЬУ р╕Др╕зр╕▓р╕бр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф: р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 300 DPI\n")
  cat("   тЬУ р╕Др╕зр╕▓р╕бр╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ: р╣Др╕бр╣Ир╣Ар╕Ър╕ер╕н, р╣Бр╕кр╕Зр╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н\n") 
  cat("   тЬУ р╕Бр╕▓р╕гр╕Др╕гр╕нр╕Ър╕Хр╕▒р╕Ф: р╣Ар╕Йр╕Юр╕▓р╕░р╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕Др╕│р╕Хр╕нр╕Ъ\n")
  cat("   тЬУ р╕Чр╕┤р╕ир╕Чр╕▓р╕З: р╕ар╕▓р╕Юр╕Хр╕▒р╣Йр╕Зр╕Хр╕гр╕З, р╣Др╕бр╣Ир╣Ар╕нр╕╡р╕вр╕З\n")
  cat("   тЬУ р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ: JPG р╕лр╕гр╕╖р╕н PNG\n")
  cat("   тЬУ р╕Вр╕Щр╕▓р╕Фр╣Др╕Яр╕ер╣М: р╣Др╕бр╣Ир╣Ар╕Бр╕┤р╕Щ 20MB р╕Хр╣Ир╕нр╣Др╕Яр╕ер╣М\n")
}

# 2. тЬЕ р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕гр╕░р╣Ар╕Ър╕╡р╕вр╕Ър╣Др╕Яр╕ер╣М
organize_image_files <- function(source_dir, output_dir) {
  # р╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М
  dir.create(file.path(output_dir, "processed"), showWarnings = FALSE)
  dir.create(file.path(output_dir, "failed"), showWarnings = FALSE)
  dir.create(file.path(output_dir, "backup"), showWarnings = FALSE)
  
  cat("ЁЯУБ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М:\n")
  cat("   ЁЯУВ", output_dir, "/processed/  <- р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Бр╕ер╣Йр╕з\n")
  cat("   ЁЯУВ", output_dir, "/failed/     <- р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Др╕бр╣Ир╣Др╕Фр╣Й\n") 
  cat("   ЁЯУВ", output_dir, "/backup/     <- р╕кр╕│р╕гр╕нр╕Зр╣Др╕Яр╕ер╣Мр╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ\n")
}

# 3. тЬЕ р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╣Бр╕Ър╕Ър╣Ар╕Ыр╣Зр╕Щр╕гр╕░р╕Ър╕Ъ
create_naming_convention <- function() {
  cat("ЁЯУЭ р╣Бр╕Щр╕зр╕Чр╕▓р╕Зр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М:\n")
  cat("   р╕гр╕╣р╕Ыр╣Бр╕Ър╕Ъ: student_[ID]_item_[ITEM]_page_[PAGE].jpg\n")
  cat("   р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З:\n")
  cat("     - student_001_item_006_page_1.jpg\n")
  cat("     - student_002_item_006_page_1.jpg\n")
  cat("     - student_003_item_007_page_1.jpg\n")
}

# 4. тЬЕ р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Бр╕Ър╕Ър╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
safe_ocr_processing <- function(image_paths, ...) {
  # р╕кр╕гр╣Йр╕▓р╕Зр╕Бр╕▓р╕гр╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
  backup_dir <- paste0("backup_", Sys.Date())
  dir.create(backup_dir, showWarnings = FALSE)
  
  cat("ЁЯТ╛ р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щ:", backup_dir, "\n")
  
  # р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕Юр╕гр╣Йр╕нр╕б error handling
  tryCatch({
    results <- ocr_batch_handwriting(
      image_paths = image_paths,
      save_intermediate = TRUE,  # р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Чр╕▓р╕З
      ...
    )
    
    # р╕кр╕│р╕гр╕нр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
    write_csv(results, file.path(backup_dir, "ocr_results.csv"))
    cat("тЬЕ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕кр╕│р╕гр╕нр╕Зр╣Бр╕ер╣Йр╕з\n")
    
    return(results)
    
  }, error = function(e) {
    cat("тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф:", e$message, "\n")
    cat("ЁЯТб р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:\n")
    cat("   - API key р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И\n")
    cat("   - р╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Юр╣Ар╕кр╕╡р╕вр╕лр╕▓р╕вр╕лр╕гр╕╖р╕нр╣Др╕бр╣И\n")
    cat("   - р╣Ар╕Щр╣Зр╕Хр╣Ар╕зр╕┤р╕гр╣Мр╕Бр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Ыр╕Бр╕Хр╕┤р╕лр╕гр╕╖р╕нр╣Др╕бр╣И\n")
    return(NULL)
  })
}

# 5. тЬЕ р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ
pre_flight_check <- function(image_dir, api_key = NULL) {
  cat("ЁЯЪА р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╣Ар╕гр╕┤р╣Ир╕б OCR\n")
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ API key
  api_key <- api_key %||% Sys.getenv("OPENAI_API_KEY")
  if (api_key == "" || is.null(api_key)) {
    cat("тЭМ р╣Др╕бр╣Ир╕Юр╕Ъ OpenAI API key\n")
    return(FALSE)
  } else {
    cat("тЬЕ р╕Юр╕Ъ API key\n")
  }
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю
  if (!dir.exists(image_dir)) {
    cat("тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М:", image_dir, "\n")
    return(FALSE)
  }
  
  image_files <- list.files(image_dir, pattern = "\\.(jpg|jpeg|png)$", ignore.case = TRUE)
  cat("ЁЯУБ р╕Юр╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю:", length(image_files), "р╣Др╕Яр╕ер╣М\n")
  
  if (length(image_files) == 0) {
    cat("тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Юр╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М\n")
    return(FALSE)
  }
  
  # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╕Щр╕▓р╕Фр╣Др╕Яр╕ер╣М
  file_sizes <- file.info(file.path(image_dir, image_files))$size / 1024 / 1024  # MB
  large_files <- which(file_sizes > 20)
  
  if (length(large_files) > 0) {
    cat("тЪая╕П  р╣Др╕Яр╕ер╣Мр╣Гр╕лр╕Нр╣Ир╣Ар╕Бр╕┤р╕Щ 20MB:", length(large_files), "р╣Др╕Яр╕ер╣М\n")
    cat("   р╣Бр╕Щр╕░р╕Щр╕│р╣Гр╕лр╣Йр╕ер╕Фр╕Вр╕Щр╕▓р╕Фр╕Бр╣Ир╕нр╕Щр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е\n")
  }
  
  # р╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Бр╕▓р╕гр╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ
  estimated_cost <- length(image_files) * 1000 * 0.00015 / 1000  # р╕Ыр╕гр╕░р╕бр╕▓р╕У 1000 tokens/р╕ар╕▓р╕Ю
  cat("ЁЯТ░ р╕Ыр╕гр╕░р╕бр╕▓р╕Ур╕Бр╕▓р╕гр╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ: $", round(estimated_cost, 4), 
      " (", round(estimated_cost * 35, 2), " р╕Ър╕▓р╕Ч)\n")
  
  cat("тЬЕ р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕гр╕┤р╣Ир╕б OCR!\n")
  return(TRUE)
}

# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Best Practices
run_complete_ocr_workflow <- function(image_dir, output_dir) {
  # 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╣Ар╕гр╕┤р╣Ир╕б
  if (!pre_flight_check(image_dir)) {
    stop("р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕бр╣Ир╕Ьр╣Ир╕▓р╕Щ р╕Бр╕гр╕╕р╕Ур╕▓р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╣Ир╕нр╕Щ")
  }
  
  # 2. р╕Ир╕▒р╕Фр╕гр╕░р╣Ар╕Ър╕╡р╕вр╕Ър╣Др╕Яр╕ер╣М
  organize_image_files(image_dir, output_dir)
  
  # 3. р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕нр╕вр╣Ир╕▓р╕Зр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
  image_files <- list.files(image_dir, pattern = "\\.(jpg|png)$", 
                           full.names = TRUE, ignore.case = TRUE)
  
  results <- safe_ocr_processing(
    image_paths = image_files,
    batch_size = 5,
    delay_seconds = 2,
    progress = TRUE
  )
  
  # 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Ю
  if (!is.null(results)) {
    reliability_check <- assess_ocr_reliability(results)
    cost_analysis <- calculate_ocr_cost(results)
  }
  
  return(results)
}
```

#### ЁЯОп р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╕Бр╕▓р╕гр╣Гр╕Кр╣Й OCR р╣Гр╕лр╣Йр╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю

##### 1. **р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Др╕╕р╕Ур╕ар╕▓р╕Юр╕ар╕▓р╕Юр╕Бр╣Ир╕нр╕Щ OCR**
```bash
# р╣Гр╕Кр╣Й ImageMagick р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕ар╕▓р╕Ю (р╕Цр╣Йр╕▓р╕бр╕╡)
convert input.jpg -density 300 -sharpen 0x1 -contrast-stretch 0.1x0.1% output.jpg

# р╕лр╕гр╕╖р╕нр╣Гр╕Кр╣Й R package magick
library(magick)
img <- image_read("student_answer.jpg")
img_processed <- img %>%
  image_resize("2000x") %>%      # р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф
  image_enhance() %>%            # р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕Др╕бр╕Кр╕▒р╕Ф
  image_contrast(sharpen = 1)    # р╣Ар╕Юр╕┤р╣Ир╕б contrast

image_write(img_processed, "student_answer_processed.jpg")
```

##### 2. **р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣Мр╕Вр╕Щр╕▓р╕Фр╣Гр╕лр╕Нр╣И**
```r
# р╣Бр╕Ър╣Ир╕Зр╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Ар╕Ыр╣Зр╕Щр╕Бр╕ер╕╕р╣Ир╕бр╣Ар╕ер╣Зр╕Бр╣Ж
process_large_batch <- function(image_dir, max_batch_size = 20) {
  all_files <- list.files(image_dir, pattern = "\\.(jpg|png)$", full.names = TRUE)
  n_batches <- ceiling(length(all_files) / max_batch_size)
  
  all_results <- list()
  
  for (i in 1:n_batches) {
    start_idx <- (i - 1) * max_batch_size + 1
    end_idx <- min(i * max_batch_size, length(all_files))
    batch_files <- all_files[start_idx:end_idx]
    
    cat("р╕Бр╕│р╕ер╕▒р╕Зр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е batch", i, "/", n_batches, "\n")
    
    batch_result <- ocr_batch_handwriting(
      image_paths = batch_files,
      batch_size = 5,
      delay_seconds = 3
    )
    
    # р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╣Бр╕Хр╣Ир╕ер╕░ batch
    write_csv(batch_result, paste0("batch_", i, "_results.csv"))
    all_results[[i]] <- batch_result
    
    # р╕Юр╕▒р╕Бр╕гр╕░р╕лр╕зр╣Ир╕▓р╕З batch
    if (i < n_batches) Sys.sleep(10)
  }
  
  return(bind_rows(all_results))
}
```

##### 3. **р╕Бр╕▓р╕г Validate р╕Ьр╕е OCR**
```r
# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Вр╕нр╕З OCR
validate_ocr_output <- function(ocr_results, min_chars = 20, max_chars = 2000) {
  validation_report <- ocr_results %>%
    mutate(
      char_count = nchar(answer),
      has_thai = grepl("[р╕Б-р╕о]", answer),
      has_numbers = grepl("[0-9]", answer),
      has_english = grepl("[a-zA-Z]", answer),
      too_short = char_count < min_chars,
      too_long = char_count > max_chars,
      suspicious = too_short | too_long | (!has_thai & char_count > 50)
    )
  
  # р╕кр╕гр╕╕р╕Ыр╕Ьр╕е
  cat("ЁЯУК р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕г Validate OCR:\n")
  cat("   р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф:", nrow(validation_report), "р╣Др╕Яр╕ер╣М\n")
  cat("   р╕кр╕▒р╣Йр╕Щр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы:", sum(validation_report$too_short), "р╣Др╕Яр╕ер╣М\n")
  cat("   р╕вр╕▓р╕зр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы:", sum(validation_report$too_long), "р╣Др╕Яр╕ер╣М\n")  
  cat("   р╕Щр╣Ир╕▓р╕кр╕Зр╕кр╕▒р╕в:", sum(validation_report$suspicious), "р╣Др╕Яр╕ер╣М\n")
  
  # р╣Бр╕кр╕Фр╕Зр╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Щр╣Ир╕▓р╕кр╕Зр╕кр╕▒р╕в
  suspicious_files <- validation_report %>%
    filter(suspicious) %>%
    select(image_file, char_count, answer) %>%
    slice_head(n = 5)
  
  if (nrow(suspicious_files) > 0) {
    cat("\nтЪая╕П  р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Др╕зр╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ:\n")
    for (i in 1:nrow(suspicious_files)) {
      cat("   ", suspicious_files$image_file[i], 
          " (", suspicious_files$char_count[i], " р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г)\n")
    }
  }
  
  return(validation_report)
}
```

#### ЁЯУЪ р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З

```r
# ========== р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕╡р╣И 1: р╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М ==========
math_ocr_workflow <- function() {
  # System prompt р╣Ар╕Йр╕Юр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М
  math_prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ:
  - р╕Хр╕▒р╕зр╣Ар╕ер╕Вр╣Бр╕ер╕░р╣Ар╕ир╕йр╕кр╣Ир╕зр╕Щ
  - р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕Чр╕▓р╕Зр╕Др╕Ур╕┤р╕Хр╕ир╕▓р╕кр╕Хр╕гр╣М (+, -, ├Ч, ├╖, =, тИЪ, ^)
  - р╕кр╕бр╕Бр╕▓р╕гр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕У
  - р╕лр╕Щр╣Ир╕зр╕вр╕Бр╕▓р╕гр╕зр╕▒р╕Ф (р╕Лр╕б., р╕Хр╕г.р╕б., р╕ер╕Ъ.р╕б.)
  р╣Гр╕лр╣Йр╣Бр╕вр╕Бр╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Чр╕│р╣Вр╕Ир╕Чр╕вр╣Мр╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щр╕Ър╕гр╕гр╕Чр╕▒р╕Ф"
  
  image_files <- list.files("math_exam/", pattern = "\\.jpg$", full.names = TRUE)
  
  results <- ocr_batch_handwriting(
    image_paths = image_files,
    system_prompt = math_prompt,
    model_config = "gpt-4o",  # р╣Гр╕Кр╣Йр╣Вр╕бр╣Ар╕Фр╕ер╕Чр╕╡р╣Ир╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Бр╕зр╣Ир╕▓
    batch_size = 3,
    delay_seconds = 5
  )
  
  return(results)
}

# ========== р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕╡р╣И 2: р╕Вр╣Йр╕нр╕кр╕нр╕Ър╣Ар╕гр╕╡р╕вр╕Зр╕Др╕зр╕▓р╕б ==========
essay_ocr_workflow <- function() {
  essay_prompt <- "р╕кр╕Бр╕▒р╕Фр╣Ар╕гр╕╡р╕вр╕Зр╕Др╕зр╕▓р╕бр╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н р╣Гр╕лр╣Йр╕Др╕зр╕▓р╕бр╕кр╕│р╕Др╕▒р╕Нр╕Бр╕▒р╕Ъ:
  - р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕вр╣Ир╕нр╕лр╕Щр╣Йр╕▓
  - р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕лр╕бр╕▓р╕вр╕зр╕гр╕гр╕Др╕Хр╕нр╕Щ
  - р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╣Вр╕вр╕Зр╕Др╕зр╕▓р╕бр╕Др╕┤р╕Ф
  - р╕Др╕зр╕▓р╕бр╕кр╕бр╕Ър╕╣р╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б
  р╣Бр╕вр╕Бр╕вр╣Ир╕нр╕лр╕Щр╣Йр╕▓р╕Фр╣Йр╕зр╕вр╕Бр╕▓р╕гр╕Вр╕╢р╣Йр╕Щр╕Ър╕гр╕гр╕Чр╕▒р╕Фр╣Гр╕лр╕бр╣И"
  
  essay_files <- list.files("essay_exam/", pattern = "\\.jpg$", full.names = TRUE)
  
  results <- ocr_batch_handwriting(
    image_paths = essay_files,
    system_prompt = essay_prompt,
    max_tokens = 1500,  # р╣Ар╕Юр╕┤р╣Ир╕б tokens р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕гр╕╡р╕вр╕Зр╕Др╕зр╕▓р╕бр╕вр╕▓р╕з
    batch_size = 2,
    delay_seconds = 8
  )
  
  return(results)
}

# ========== р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕╡р╣И 3: р╕Вр╣Йр╕нр╕кр╕нр╕Ър╣Бр╕Ър╕Ър╕Ьр╕кр╕б ==========
mixed_subject_workflow <- function() {
  # р╕гр╕░р╕Ър╕╕р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Вр╣Йр╕нр╕кр╕нр╕Ър╣Гр╕Щр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М
  all_files <- list.files("mixed_exam/", pattern = "\\.jpg$", full.names = TRUE)
  
  results_list <- list()
  
  for (file in all_files) {
    # р╕гр╕░р╕Ър╕╕р╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕Ир╕▓р╕Бр╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣М
    if (grepl("math", basename(file))) {
      prompt <- create_subject_prompt("math")
      model <- "gpt-4o"
    } else if (grepl("science", basename(file))) {
      prompt <- create_subject_prompt("science")  
      model <- "gpt-4o-mini"
    } else if (grepl("thai", basename(file))) {
      prompt <- create_subject_prompt("thai")
      model <- "gpt-4o-mini"
    } else {
      prompt <- "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Ир╕▓р╕Бр╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╣Бр╕ер╕░р╣Бр╕бр╣Ир╕Щр╕вр╕│"
      model <- "gpt-4o-mini"
    }
    
    result <- ocr_handwriting(
      image_path = file,
      system_prompt = prompt,
      model_config = model
    )
    
    results_list[[basename(file)]] <- result
    Sys.sleep(2)  # р╕лр╕Щр╣Ир╕зр╕Зр╣Ар╕зр╕ер╕▓р╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╣Др╕Яр╕ер╣М
  }
  
  return(bind_rows(results_list))
}
```

### ЁЯПЖ р╕кр╕гр╕╕р╕Ы: р╕Ир╕▓р╕Б OCR р╕кр╕╣р╣Ир╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕Чр╕╡р╣Ир╕кр╕бр╕Ър╕╣р╕гр╕Ур╣М

р╕гр╕░р╕Ър╕Ъ OCR р╣Гр╕Щ kruroograder р╕Кр╣Ир╕зр╕вр╣Гр╕лр╣Йр╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Ц:

1. **р╣Бр╕Ыр╕ер╕Зр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Ар╕Ыр╣Зр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б** р╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╕кр╕╣р╕З
2. **р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╣Ар╕Ыр╣Зр╕Щр╕Кр╕╕р╕Фр╣Гр╕лр╕Нр╣И** р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю  
3. **р╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕Зр╕Хр╕▓р╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╕зр╕┤р╕Кр╕▓** р╕Чр╕╡р╣Ир╣Бр╕Хр╕Бр╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ
4. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Ю** р╣Бр╕ер╕░р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
5. **р╕Др╕│р╕Щр╕зр╕Ур╕Хр╣Йр╕Щр╕Чр╕╕р╕Щ** р╣Бр╕ер╕░р╕зр╕▓р╕Зр╣Бр╕Ьр╕Щр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
6. **р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ъ** р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╣Др╕гр╣Йр╕гр╕нр╕вр╕Хр╣Ир╕н

р╕Чр╕│р╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ър╕ер╕▓р╕вр╕бр╕╖р╕нр╣Ар╕Ыр╣Зр╕Щр╣Ар╕гр╕╖р╣Ир╕нр╕Зр╕Зр╣Ир╕▓р╕вр╣Бр╕ер╕░р╕гр╕зр╕Фр╣Ар╕гр╣Зр╕зр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ! ЁЯЪА
```
```

### р╕Бр╕▓р╕гр╕гр╕зр╕б PDF + OCR + Grading Workflow

р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕Ър╕Ър╕Др╕гр╕Ър╕зр╕Зр╕Ир╕г:

```r
# 1. р╣Бр╕вр╕Б PDF р╕Хр╕▓р╕бр╕Вр╣Йр╕нр╕кр╕нр╕Ъ
split_result <- split_pdf_by_question("exam_all.pdf", n_questions = 4)

# 2. р╣Бр╕Ыр╕ер╕З PDF р╣Ар╕Ыр╣Зр╕Щр╕ар╕▓р╕Ю (р╣Гр╕Кр╣Й pdftools р╕лр╕гр╕╖р╕н external tools)
# (р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╕нр╕▓р╕Ир╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Йр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕ар╕▓р╕вр╕Щр╕нр╕Б)

# 3. OCR р╕ар╕▓р╕Юр╕ер╕▓р╕вр╕бр╕╖р╕н
image_files <- list.files("images/", pattern = "\\.jpg$", full.names = TRUE)
ocr_results <- ocr_batch_handwriting(
  image_paths = image_files,
  system_prompt = "р╕кр╕Бр╕▒р╕Фр╕Др╕│р╕Хр╕нр╕Ър╕Вр╕нр╕Зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ир╕▓р╕Бр╕ер╕▓р╕вр╕бр╕╖р╕нр╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ"
)

# 4. р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕И
responses_from_ocr <- ocr_results %>%
  mutate(
    student_id = str_extract(image_file, "\\d+"),
    item_id = "item_006",
    response_text = answer
  ) %>%
  select(student_id, item_id, response_text)

# 5. р╕Хр╕гр╕зр╕Ир╕Вр╣Йр╕нр╕кр╕нр╕Ъ
final_results <- grade_responses(
  responses = responses_from_ocr,
  rubric = rubric,
  key = answer_key,
  .parallel = TRUE
)

# 6. р╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
export_results(final_results, "final_grades.xlsx", format = "xlsx")
```

## тЪб Performance р╣Бр╕ер╕░ Best Practices

### р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Бр╣Гр╕Кр╣Й Parallel Processing

```r
# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю
n_students <- nrow(responses)

# р╣Ар╕ер╕╖р╕нр╕Б system prompt р╕Хр╕▓р╕бр╕зр╕▒р╕Хр╕Цр╕╕р╕Ыр╕гр╕░р╕кр╕Зр╕Др╣М
assessment_prompt <- "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕бр╣Бр╕ер╕░р╕кр╕бр╣Ир╕│р╣Ар╕кр╕бр╕н р╕Хр╕▓р╕б rubric р╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Ф"

if (n_students < 10) {
  # р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Щр╣Йр╕нр╕в: р╣Гр╕Кр╣Й sequential
  results <- grade_responses(responses, rubric, key, 
                           system_prompt = assessment_prompt,
                           .parallel = FALSE)
  
} else if (n_students < 100) {
  # р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕Ыр╕▓р╕Щр╕Бр╕ер╕▓р╕З: р╣Гр╕Кр╣Й parallel р╣Бр╕Ър╕Ър╕Ир╕│р╕Бр╕▒р╕Ф cores
  results <- grade_responses(responses, rubric, key,
                           system_prompt = assessment_prompt,
                           .parallel = TRUE, .cores = 2)
                           
} else {
  # р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щр╕бр╕▓р╕Б: р╣Гр╕Кр╣Й parallel р╣Ар╕Хр╣Зр╕бр╕Чр╕╡р╣И
  optimal_cores <- get_optimal_cores(n_students, max_cores = 8)
  results <- grade_responses(responses, rubric, key,
                           system_prompt = assessment_prompt,
                           .parallel = TRUE, .cores = optimal_cores)
}
```

### р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г Memory р╣Бр╕ер╕░ Error
```r
# р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Вр╕Щр╕▓р╕Фр╣Гр╕лр╕Нр╣И
custom_prompt <- "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕нр╕Ър╕Др╕нр╕Ър╣Бр╕ер╕░р╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕б"

results <- tryCatch({
  grade_responses(responses, rubric, key, 
                system_prompt = custom_prompt,
                .parallel = TRUE, .cores = 4)
}, error = function(e) {
  cat("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕ер╕нр╕З sequential processing\n")
  grade_responses(responses, rubric, key,
                system_prompt = custom_prompt,
                .parallel = FALSE)
})
```

### р╕Бр╕▓р╕гр╣Ар╕ер╕╖р╕нр╕Б System Prompt р╕Хр╕▓р╕бр╕зр╕▒р╕Хр╕Цр╕╕р╕Ыр╕гр╕░р╕кр╕Зр╕Др╣М

| р╕зр╕▒р╕Хр╕Цр╕╕р╕Ыр╕гр╕░р╕кр╕Зр╕Др╣М | System Prompt р╕Чр╕╡р╣Ир╣Бр╕Щр╕░р╕Щр╕│ |
|-------------|----------------------|
| **р╕Бр╕▓р╕гр╕кр╕нр╕Ър╕Бр╕ер╕▓р╕Зр╕ар╕▓р╕Д/р╕Ыр╕ер╕▓р╕вр╕ар╕▓р╕Д** | "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╕Хр╕▓р╕б rubric р╣Ар╕Щр╣Йр╕Щр╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ" |
| **р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╣Ар╕гр╕╡р╕вр╕Щ** | "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕Чр╕╡р╣Ир╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓ р╣Гр╕лр╣Й feedback р╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣М" |
| **р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╣Вр╕Др╕гр╕Зр╕Зр╕▓р╕Щ** | "р╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕Др╕зр╕▓р╕бр╕Др╕┤р╕Фр╕кр╕гр╣Йр╕▓р╕Зр╕кр╕гр╕гр╕Др╣Мр╣Бр╕ер╕░р╕Бр╕гр╕░р╕Ър╕зр╕Щр╕Бр╕▓р╕гр╕Др╕┤р╕Ф" |
| **р╕Бр╕▓р╕гр╕Эр╕╢р╕Бр╕лр╕▒р╕Ф** | "р╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щр╕Чр╕╡р╣Ир╣Ар╕Щр╣Йр╕Щр╕Бр╕▓р╕гр╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Й р╕Кр╕╡р╣Йр╕Ир╕╕р╕Фр╕Фр╕╡р╣Бр╕ер╕░р╕Ир╕╕р╕Фр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З" |
| **р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╣Ар╕бр╕┤р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ъ ESL** | "Use simple English, focus on content over language perfection" |

## ЁЯзк р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕ер╕░р╕Юр╕▒р╕Тр╕Щр╕▓

```r
# р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╣Бр╕Юр╣Зр╕Бр╣Ар╕Бр╕И
devtools::test()

# р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕Юр╣Зр╕Бр╣Ар╕Бр╕И
devtools::check()

# р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕Бр╕кр╕▓р╕г
devtools::document()

# р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З
responses_sample <- responses[1:5, ]  # р╣Ар╕ер╕╖р╕нр╕Бр╣Бр╕Др╣И 5 р╕Др╕Щ
test_prompt <- "р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ р╣Гр╕лр╣Й feedback р╕Чр╕╡р╣Ир╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф"
results_test <- grade_responses(responses_sample, rubric, key, 
                              system_prompt = test_prompt)
```

## ЁЯУБ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣М

```
kruroograder/
тФЬтФАтФА R/                          # р╕Лр╕нр╕гр╣Мр╕кр╣Вр╕Др╣Йр╕Фр╕лр╕ер╕▒р╕Б
тФВ   тФЬтФАтФА grading.R              # р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕Др╕░р╣Бр╕Щр╕Щр╕лр╕ер╕▒р╕Б
тФВ   тФЬтФАтФА utils.R                # р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Кр╣Ир╕зр╕в р╣Бр╕ер╕░ parallel processing
тФВ   тФЬтФАтФА 02_load_rubric.R       # р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф rubric р╣Бр╕ер╕░ answer key  
тФВ   тФЬтФАтФА 03_prompting.R         # р╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З prompts р╕кр╕│р╕лр╕гр╕▒р╕Ъ LLM
тФВ   тФФтФАтФА export.R               # р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕нр╕нр╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
тФЬтФАтФА inst/                      # р╣Др╕Яр╕ер╣М template р╣Бр╕ер╕░р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З
тФВ   тФЬтФАтФА templates/             # Template р╕кр╕│р╕лр╕гр╕▒р╕Ъ prompts
тФВ   тФЬтФАтФА rubric/               # р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З rubric files
тФВ   тФФтФАтФА extdata/              # р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З
тФЬтФАтФА tests/                     # р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ
тФВ   тФФтФАтФА testthat/             
тФЬтФАтФА data/                      # р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕гр╕┤р╕З (р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕З)
тФВ   тФЬтФАтФА raw/
тФВ   тФВ   тФФтФАтФА responses.csv     # р╕Др╕│р╕Хр╕нр╕Ър╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
тФВ   тФФтФАтФА output/               # р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
тФЬтФАтФА rubric/                    # р╣Ар╕Бр╕Ур╕Ср╣Мр╕Бр╕▓р╕гр╣Гр╕лр╣Йр╕Др╕░р╣Бр╕Щр╕Щ (р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕нр╕З)
тФВ   тФЬтФАтФА item_006_rubric.md
тФВ   тФФтФАтФА item_006_key.md
тФЬтФАтФА logs/                      # р╣Др╕Яр╕ер╣М log (р╕кр╕гр╣Йр╕▓р╕Зр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤)
тФЬтФАтФА DESCRIPTION               # р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Юр╣Зр╕Бр╣Ар╕Бр╕И
тФЬтФАтФА NAMESPACE                 # Export/Import functions
тФФтФАтФА README.md                 # р╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Щр╕╡р╣Й
```

## ЁЯФН р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╕Ър╣Ир╕нр╕в

### р╕Ыр╕▒р╕Нр╕лр╕▓ API Key
```r
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ API key
Sys.getenv("OPENAI_API_KEY")

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Гр╕Щ R session
Sys.setenv(OPENAI_API_KEY = "your-key-here")
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ Memory р╣Ар╕бр╕╖р╣Ир╕нр╣Гр╕Кр╣Й Parallel
```r
# р╕ер╕Фр╕Ир╕│р╕Щр╕зр╕Щ cores
results <- grade_responses(responses, rubric, key, 
                         .parallel = TRUE, .cores = 2)

# р╕лр╕гр╕╖р╕нр╣Бр╕Ър╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕нр╕Бр╣Ар╕Ыр╣Зр╕Щр╕кр╣Ир╕зр╕Щр╕вр╣Ир╕нр╕в
batch_size <- 50
n_batches <- ceiling(nrow(responses) / batch_size)

for (i in 1:n_batches) {
  start_idx <- (i - 1) * batch_size + 1
  end_idx <- min(i * batch_size, nrow(responses))
  
  batch_responses <- responses[start_idx:end_idx, ]
  batch_results <- grade_responses(batch_responses, rubric, key)
  
  # р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Бр╕Хр╣Ир╕ер╕░ batch
  write_csv(batch_results, paste0("output/batch_", i, ".csv"))
}
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ Model Names
```r
# р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕н model р╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
correct_models <- c(
  "gpt-4o-mini",    # р╣Др╕бр╣Ир╣Гр╕Кр╣И "gpt_4o-mini"
  "gpt-4o",
  "gpt-4-turbo",
  "gpt-3.5-turbo"
)

# р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ
results <- grade_responses(
  responses = responses,
  rubric = rubric,
  key = answer_key,
  model_config = "gpt-4o-mini"  # р╕Кр╕╖р╣Ир╕нр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
)
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ OCR р╣Бр╕ер╕░ PDF
```r
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣Мр╕Бр╣Ир╕нр╕Щ OCR
if (!file.exists("image.jpg")) {
  stop("р╣Др╕бр╣Ир╕Юр╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю")
}

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ API key р╕кр╕│р╕лр╕гр╕▒р╕Ъ OCR
if (Sys.getenv("OPENAI_API_KEY") == "") {
  stop("р╕Хр╣Йр╕нр╕Зр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ OPENAI_API_KEY р╕кр╕│р╕лр╕гр╕▒р╕Ъ OCR")
}

# PDF structure р╕Чр╕╡р╣Ир╣Др╕бр╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
inspect_result <- inspect_pdf_structure("exam.pdf", 4)
if (inspect_result$remainder > 0) {
  warning("PDF р╕нр╕▓р╕Ир╕бр╕╡р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕вр╕Б")
}
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ tidyllm
```r
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З tidyllm
tidyllm::chat_test()

# р╕нр╕▒р╕Ыр╣Ар╕Фр╕Х tidyllm
install.packages("tidyllm")
```

### р╕Ыр╕▒р╕Нр╕лр╕▓ Parallel Processing р╕Ър╕Щ macOS/Linux
```r
# р╕лр╕▓р╕Бр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▒р╕Ъ multisession
if (.Platform$OS.type == "unix") {
  future::plan(future::multicore)  # р╣Гр╕Кр╣Й multicore р╣Бр╕Чр╕Щ multisession
} else {
  future::plan(future::multisession)
}
```

## ЁЯУД License р╣Бр╕ер╕░р╕Бр╕▓р╕гр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕З

MIT License - р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Гр╕Щ [LICENSE](LICENSE) file

### р╕Бр╕▓р╕гр╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕З
р╕лр╕▓р╕Бр╕Др╕╕р╕Ур╣Гр╕Кр╣Й kruroograder р╣Гр╕Щр╕Зр╕▓р╕Щр╕зр╕┤р╕Ир╕▒р╕в р╕Бр╕гр╕╕р╕Ур╕▓р╕нр╣Йр╕▓р╕Зр╕нр╕┤р╕Зр╕Фр╕▒р╕Зр╕Щр╕╡р╣Й:

```
Srisuttiyakorn, S. (2024). kruroograder: Automated Essay Grading System Using LLM. 
R package version 0.1.0.
```

## ЁЯдЭ р╕Бр╕▓р╕гр╕кр╕Щр╕▒р╕Ър╕кр╕Щр╕╕р╕Щр╣Бр╕ер╕░р╕Хр╕┤р╕Фр╕Хр╣Ир╕н

- **Email**: choat.cu@gmail.com
- **Issues**: р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ыр╕▒р╕Нр╕лр╕▓р╕Ьр╣Ир╕▓р╕Щ GitHub Issues  
- **р╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓**: р╕вр╕┤р╕Щр╕Фр╕╡р╕гр╕▒р╕Ъ Pull Requests р╣Бр╕ер╕░р╕Вр╣Йр╕нр╣Ар╕кр╕Щр╕нр╣Бр╕Щр╕░

### р╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓р╕Хр╣Ир╕н
- [ ] р╕гр╕нр╕Зр╕гр╕▒р╕Ъ multiple items р╣Гр╕Щр╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з
- [ ] Web interface р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Зр╣Ир╕▓р╕в
- [ ] р╕гр╕нр╕Зр╕гр╕▒р╕Ъ LLM providers р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
- [ ] р╕гр╕░р╕Ър╕Ъ calibration р╣Бр╕ер╕░ validation
- [ ] Integration р╕Бр╕▒р╕Ъ Learning Management Systems

---

*р╕Юр╕▒р╕Тр╕Щр╕▓р╣Вр╕Фр╕в Siwachoat Srisuttiyakorn р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕ир╕╢р╕Бр╕йр╕▓р╕Чр╕╡р╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Юр╣Бр╕ер╕░р╣Ар╕Ыр╣Зр╕Щр╕Шр╕гр╕гр╕б* ЁЯОУ

![S__75743284_0 copy](https://github.com/user-attachments/assets/a98be442-add5-44ca-a9f8-81ca63cf2a24)
